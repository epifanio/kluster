import unittest
import pytest
from HSTB.kluster.modules.backscatter import *


class TestAllscatter(unittest.TestCase):
    """
    Build arrays and metadata from the first ping in file EM2040_Fairweather_SmallFile\0009_20170523_181119_FA2806.all
    """

    @classmethod
    def setUpClass(cls) -> None:
        cls.rdict = {'Counter': '61966',
                     'SystemSerial#': '40111',
                     'OperatorStationStatus': '00000000',
                     'ProcessingUnitStatus': '00000000',
                     'BSPStatus': '00000000',
                     'SonarHeadOrTransceiverStatus': '00000000',
                     'Mode': '10100001',
                     'FilterID': '00000110',
                     'MinDepth': '1',
                     'MaxDepth': '200',
                     'AbsorptionCoefficent': '68.9',
                     'TransmitPulseLength': '0.00037',
                     'TransmitBeamWidth': '1.0',
                     'TransmitPower': '0',
                     'ReceiveBeamWidth': '1.3',
                     'ReceiveBandWidth50Hz': '255',
                     'ReceiverFixedGain': '13',
                     'TVGlawCrossoverAngle': '10',
                     'SourceOfSoundSpeed': '00000000',
                     'MaxPortSwathWidth': '500',
                     'BeamSpacing': '00000011',
                     'MaxPortCoverage': '75',
                     'YawAndPitchStabilization': '10001010',
                     'MaxStarboardCoverage': '75',
                     'MaxStarboardSwathWidth': '500',
                     'TransmitAlongTilt': '0.0',
                     'HiLoFrequencyAbsorptionCoeffRatio': '00010000'}
        rawrint = np.array([[-14.296875, -11.6953125, -17.390625, -15.09375, -13.09375,
                             -24.59375, -13.5, -23.296875, -12.6953125, -14.296875,
                             -19.59375, -21.296875, -28.59375, -13.3984375, -20.59375,
                             -24.09375, -21.1875, -13.09375, -21.6875, -11.8984375,
                             -20.1875, -19.796875, -20.296875, -17.890625, -23.1875,
                             -22.1875, -19.59375, -24.6875, -16.09375, -22.5,
                             -23.390625, -20.09375, -20.390625, -24.59375, -19.390625,
                             -28.09375, -29.390625, -26.890625, -29.390625, -22.390625,
                             -24.890625, -24.390625, -42.09375, -23., -26.6875,
                             -21., -23., -30.390625, -25.890625, -22.6875,
                             -30.296875, -33.40625, -22., -28.6875, -18.203125,
                             -23.09375, -50.59375, -22.59375, -27.1875, -24.890625,
                             -24.390625, -27.5, -26.09375, -23.1875, -20.390625,
                             -19.796875, -31.796875, -40.6875, -24., -25.6875,
                             -28.59375, -22.390625, -27.890625, -23.390625, -24.,
                             -22.390625, -21.390625, -18.296875, -19.5, -29.1875,
                             -31.390625, -37.5, -24.1875, -22.6875, -35.09375,
                             -15.6953125, -19.796875, -14.3984375, -21.09375, -20.09375,
                             -26., -20.890625, -25., -32., -23.59375,
                             -18.703125, -21.59375, -30.1875, -21.796875, -24.,
                             -23.09375, -24., -23.59375, -27.09375, -21.390625,
                             -28.890625, -23.6875, -25.390625, -32.59375, -17.796875,
                             -28.890625, -17.5, -22.59375, -28.296875, -19.09375,
                             -24., -23.59375, -20.59375, -19.59375, -19.1875,
                             -22.796875, -25.390625, -30.09375, -19.796875, -21.390625,
                             -19.09375, -19.296875, -17.09375, -22.390625, -24.59375,
                             -22.09375, -21.5, -16.5, -28.390625, -24.09375,
                             -20.6875, -18.59375, -32.09375, -22., -18.5,
                             -24.296875, -19.59375, -16.09375, -25.09375, -36.6875,
                             -17.390625, -19.59375, -18.890625, -16.296875, -22.6875,
                             -19.296875, -28.296875, -38.6875, -21.296875, -21.1875,
                             -26., -14.59375, -32.6875, -19., -22.6875,
                             -17.5, -22.09375, -20., -19.796875, -18.796875,
                             -18.296875, -27., -21.6875, -32., -17.796875,
                             -25.6875, -20.09375, -16.5, -19.296875, -17.296875,
                             -16.890625, -16.796875, -20.890625, -20.59375, -16.703125,
                             -19.796875, -22.59375, -16.890625, -25.1875, -17.5,
                             -19.59375, -20.6875, -18.59375, -20., -21.390625,
                             -27.890625, -19.5, -40.1875, -23.09375, -18.296875,
                             -18.796875, -21.1875, -35.5, -21.1875, -23.796875,
                             -30.1875, -16.5, -25.296875, -15.796875, -25.890625,
                             -37.40625, -20.1875, -16.203125, -16.703125, -18.296875,
                             -20.5, -22.6875, -19.890625, -24.59375, -30.09375,
                             -22.09375, -22.59375, -23.5, -26.296875, -17.390625,
                             -29.390625, -19.1875, -28.296875, -18.703125, -20.09375,
                             -30.1875, -23.1875, -21.390625, -21.296875, -25.5,
                             -20.6875, -28.890625, -24.09375, -17.703125, -21.6875,
                             -22.1875, -19.6875, -23.796875, -27.1875, -18.5,
                             -27.890625, -27.59375, -20., -25.390625, -18.296875,
                             -21.59375, -20.296875, -34.1875, -23.5, -27.890625,
                             -32.78125, -18.59375, -20.296875, -21.6875, -21.890625,
                             -17.203125, -24.09375, -27.796875, -20.59375, -23.296875,
                             -23.796875, -29.59375, -15.3984375, -28., -17.890625,
                             -11.5, -19.1875, -27.6875, -19.5, -16.796875,
                             -19.296875, -24.1875, -16.390625, -15., -20.,
                             -17.890625, -16.59375, -19.09375, -22.09375, -22.5,
                             -31.5, -19., -22.390625, -17.296875, -18.203125,
                             -18.5, -17.59375, -20.1875, -16.703125, -24.09375,
                             -15.6953125, -13.8984375, -17.390625, -20.296875, -31.390625,
                             -18.390625, -18.296875, -17.796875, -21.5, -21.,
                             -17.5, -24.890625, -14.296875, -23.296875, -25.296875,
                             -25.1875, -25.09375, -30.09375, -18.796875, -11.6953125,
                             -12.1953125, -16.59375, -20.890625, -23., -20.390625,
                             -16.296875, -14.09375, -16., -16.390625, -24.890625,
                             -31.6875, -21., -37.78125, -24.390625, -20.09375,
                             -12.1953125, -17.390625, -13.296875, -14., -10.09375,
                             -16.09375, -20.09375, -14.8984375, -31.390625, -17.296875,
                             -21., -24.5, -19.1875, -21.09375, -20.,
                             -24.5, -11.8984375, -13.5, -13.8984375, -10.3984375,
                             -26.5, -15.1953125, -17.5, -23.296875, -20.,
                             -25.6875, -15.5, -18.59375, -18.203125, -16.59375,
                             -18.203125, -19.6875, -34.1875, -12.59375, -11.,
                             -11.3984375, -27.59375, -10.3984375, -10., -9.8984375,
                             -23.296875, -12.296875, -13.1953125, -14.3984375, -19.6875,
                             -14.296875, -15.796875, -13.09375, -17.296875, -17.5,
                             -12.09375, -16.796875, -31., -16.09375, -10.09375,
                             -10.796875, -21.390625, -16.890625, -13.59375, -13.296875,
                             -9.796875, -20.796875, -18.5, -19.1875, -17.09375,
                             -15.5, -14.59375, -15.796875, -18.390625, -13.,
                             -26.6875, -11.3984375, -12.296875, -14.5, -14.1953125]],
                           dtype=np.float32)
        cls.raw_intensity = xr.DataArray(data=rawrint, coords={'time': [1495563079.5340009], 'beam': np.arange(400)})
        slint = np.array([[249.09961, 247.86368, 246.6289, 245.39516, 244.16235,
                          242.93114, 241.70059, 240.47023, 239.24152, 238.01395,
                          236.78754, 235.56253, 234.33714, 233.11426, 231.89203,
                          230.67062, 229.45018, 228.23106, 227.01357, 225.79709,
                          224.58205, 223.36794, 222.15515, 220.94315, 220.241,
                          218.9029, 217.42786, 216.43959, 215.72914, 215.10544,
                          213.1238, 211.61311, 210.78334, 207.34787, 206.32935,
                          205.48502, 204.98837, 204.3698, 202.84937, 201.72763,
                          200.59303, 198.32169, 198.54074, 196.72131, 194.9207,
                          194.20839, 193.34044, 192.33963, 191.27554, 190.22118,
                          189.72842, 187.97, 187.14197, 185.64667, 183.92302,
                          182.64671, 181.25298, 180.64835, 179.92558, 178.85934,
                          177.6135, 176.25168, 174.71793, 173.57483, 172.53319,
                          171.26556, 170.47221, 169.63046, 168.35498, 167.18393,
                          166.22244, 165.25134, 163.54063, 162.82753, 162.001,
                          160.4067, 159.03482, 157.9785, 156.9299, 155.89261,
                          154.87482, 153.76306, 152.55583, 151.54088, 150.63786,
                          149.65729, 148.8061, 147.68553, 146.72816, 145.75171,
                          144.72958, 143.81831, 142.83162, 141.88394, 140.99078,
                          139.9588, 138.7754, 137.57495, 136.68585, 135.77794,
                          134.79533, 133.91708, 133.09058, 132.07858, 131.03812,
                          130.15457, 129.33266, 128.3034, 127.390854, 126.64725,
                          125.75369, 124.800896, 123.855316, 122.92755, 121.91127,
                          121.063675, 120.35491, 119.54374, 118.60053, 117.80973,
                          116.81808, 115.75807, 115.024605, 114.25909, 113.493904,
                          112.73828, 111.926315, 111.11742, 110.429405, 109.750336,
                          109.06541, 108.37607, 107.55595, 106.87724, 106.24603,
                          105.5284, 104.9103, 104.2666, 103.63032, 103.073524,
                          102.48483, 101.81146, 101.17043, 100.59165, 100.079834,
                          99.543015, 99.03491, 98.55737, 98.096794, 97.52773,
                          97.12741, 96.82976, 96.16499, 95.66057, 95.46257,
                          94.89989, 94.602905, 94.36335, 93.95862, 93.590706,
                          93.34904, 93.103806, 92.807884, 92.55396, 92.34113,
                          92.17545, 92.03864, 91.836945, 91.66985, 91.5759,
                          91.4524, 91.3576, 91.29453, 91.28696, 91.29549,
                          91.23295, 91.22712, 91.24414, 91.39734, 91.43458,
                          91.54871, 91.64171, 91.714264, 91.93186, 92.159744,
                          92.2479, 92.573204, 92.78209, 92.95007, 93.209885,
                          93.55346, 93.88654, 94.20951, 94.52464, 94.86207,
                          95.09312, 95.27829, 95.94842, 96.511314, 96.84138,
                          97.376884, 97.75128, 98.32348, 98.86917, 99.397964,
                          99.87652, 100.35353, 100.97568, 101.60493, 102.15235,
                          102.72683, 103.38385, 103.92888, 104.62866, 105.27202,
                          105.91862, 106.661934, 107.348755, 108.02226, 108.80466,
                          109.51582, 110.21792, 111.04653, 111.775024, 112.49799,
                          113.28728, 114.043526, 114.77278, 115.65459, 116.50705,
                          117.20944, 117.85158, 118.622925, 119.55453, 120.39093,
                          121.2301, 122.06825, 122.83238, 123.76928, 124.63371,
                          125.34591, 126.21952, 127.129555, 127.9427, 128.79686,
                          129.87192, 130.84941, 131.71715, 132.5317, 133.41968,
                          134.41418, 135.34747, 136.37277, 137.31615, 138.16798,
                          139.0807, 139.95613, 140.73755, 141.57843, 142.72992,
                          143.64572, 144.53568, 145.40111, 146.39781, 147.54773,
                          148.59317, 149.77963, 150.66344, 151.59567, 152.42792,
                          153.31546, 154.21205, 155.24023, 156.35301, 157.40851,
                          158.34003, 159.41129, 160.29555, 161.55554, 161.63324,
                          162.62234, 163.26906, 164.07458, 165.01955, 166.09714,
                          167.09474, 167.83713, 168.73709, 169.88077, 170.77032,
                          171.75342, 172.6049, 173.21413, 174.32622, 175.86316,
                          176.32771, 176.71968, 177.2259, 177.96835, 179.04536,
                          180.0649, 181.2892, 182.18112, 183.287, 184.39558,
                          185.57845, 185.56842, 185.9137, 187.00024, 187.85785,
                          188.49863, 189.13261, 190.59204, 191.3704, 192.09857,
                          192.65562, 193.13509, 194.78754, 195.63492, 196.28432,
                          196.45164, 197.31749, 197.92087, 198.69048, 198.91393,
                          199.5981, 200.64598, 201.12624, 202.2344, 202.64986,
                          203.35207, 203.98668, 204.9827, 205.4263, 205.75621,
                          206.09848, 206.78563, 207.50502, 208.22444, 208.64012,
                          209.53662, 210.168, 210.70471, 211.70161, 212.0225,
                          212.98714, 213.22804, 213.58054, 214.54907, 214.93353,
                          215.47964, 216.82007, 216.95264, 217.8646, 218.82051,
                          219.12523, 219.30695, 219.46996, 220.25096, 221.23906,
                          221.81053, 222.15408, 222.89615, 223.87027, 223.88942,
                          224.38715, 225.33449, 225.40385, 226.03246, 226.30563,
                          226.92667, 227.24065, 227.94363, 228.20206, 228.86595,
                          228.78912, 229.39334, 230.25772, 231.05104, 231.56996,
                          231.66298, 231.9635, 232.49884, 233.39952, 233.5699,
                          233.80649, 235.35493, 235.47133, 236.43193, 236.63956,
                          236.97134, 237.11032, 238.13354, 238.429, 238.82422,
                          239.57028, 239.81924, 239.99063, 240.51295, 241.47552]],
                         dtype=np.float32)
        cls.slant_range = xr.DataArray(data=slint, coords={'time': [1495563079.5340009], 'beam': np.arange(400)})
        cls.surface_sound_speed = xr.DataArray(data=np.array([1488.6], dtype=np.float32),
                                               coords={'time': [1495563079.5340009]})
        bangle = np.array([[1.2028904, 1.2000508, 1.1982989, 1.1965705, 1.1946673,
                           1.1929386, 1.1910355, 1.1884227, 1.1864691, 1.1845157,
                           1.1825619, 1.1804338, 1.1784799, 1.175483, 1.1733834,
                           1.1712837, 1.1693587, 1.1672585, 1.1649842, 1.1604395,
                           1.1583499, 1.1560854, 1.1538206, 1.1517304, 1.14939,
                           1.1469694, 1.1447546, 1.1424897, 1.1399992, 1.137493,
                           1.1352346, 1.1316674, 1.1291935, 1.1269627, 1.1243356,
                           1.1218544, 1.119142, 1.1150522, 1.1124953, 1.1096941,
                           1.1068945, 1.1042649, 1.1012638, 1.0957724, 1.0929211,
                           1.0899117, 1.0869315, 1.0839763, 1.0808583, 1.0779133,
                           1.0746883, 1.0717037, 1.0683844, 1.0652044, 1.0620717,
                           1.058846, 1.054074, 1.0505359, 1.0470226, 1.0435821,
                           1.0400054, 1.0366275, 1.0299692, 1.0261871, 1.0225463,
                           1.0187745, 1.0147369, 1.0108836, 1.0069387, 1.0029737,
                           0.9987941, 0.99462813, 0.9906255, 0.9862371, 0.9820476,
                           0.9776714, 0.96836, 0.9638816, 0.9592399, 0.9547704,
                           0.9499472, 0.9453205, 0.9405417, 0.9357178, 0.93069327,
                           0.9256869, 0.92047536, 0.9153276, 0.91014147, 0.90478504,
                           0.89926475, 0.89370656, 0.8881572, 0.8824248, 0.87668097,
                           0.8707921, 0.8649358, 0.8571629, 0.8508947, 0.8446399,
                           0.8384125, 0.83198637, 0.82537335, 0.8188041, 0.8120668,
                           0.80354726, 0.7965843, 0.78967005, 0.78237927, 0.7752234,
                           0.76775366, 0.7602981, 0.752666, 0.7431101, 0.73532027,
                           0.727334, 0.71933466, 0.7110157, 0.702909, 0.6942682,
                           0.68582696, 0.677231, 0.6643522, 0.6553099, 0.6462579,
                           0.6370288, 0.62764007, 0.6182504, 0.6084802, 0.5987078,
                           0.5887626, 0.5786437, 0.5685588, 0.55808747, 0.547603,
                           0.53696644, 0.52612996, 0.5152997, 0.50411844, 0.49291718,
                           0.48154938, 0.47002864, 0.4583254, 0.44468594, 0.43277466,
                           0.42069542, 0.40843463, 0.39599204, 0.38354528, 0.37095177,
                           0.35814035, 0.34512758, 0.33221018, 0.31907642, 0.30568886,
                           0.29239583, 0.27885962, 0.2653085, 0.25162542, 0.23775864,
                           0.22385895, 0.20769155, 0.19363165, 0.1793865, 0.1651305,
                           0.15068829, 0.13623846, 0.12180614, 0.10736644, 0.09273458,
                           0.07811213, 0.06348288, 0.04867339, 0.03402972, 0.01923001,
                           0.00469589, 0.01049447, 0.02524054, 0.04009461, 0.05475461,
                           -0.06961584, -0.08429861, -0.09897685, -0.11369228, -0.12823594,
                           -0.14274383, -0.15731323, -0.17185283, -0.18620741, -0.2004112,
                           -0.21254265, -0.22676563, -0.24081147, -0.25485563, -0.26873076,
                           -0.28240407, -0.29606533, -0.30967784, -0.32326257, -0.33661258,
                           -0.34984112, -0.3628534, -0.37591708, -0.38879943, -0.401502,
                           -0.41419137, -0.42670584, -0.43716323, -0.44936764, -0.4613763,
                           -0.4733925, -0.48508048, -0.49673963, -0.5082643, -0.5197743,
                           -0.53093624, -0.5421227, -0.5531204, -0.5639417, -0.5746165,
                           -0.58527285, -0.59557766, -0.6059154, -0.6160529, -0.6261887,
                           -0.63599247, -0.6457879, -0.65540373, -0.66089374, -0.67021495,
                           -0.6794932, -0.6885793, -0.69752824, -0.7066493, -0.715268,
                           -0.7238873, -0.7324719, -0.7406809, -0.7470107, -0.7552432,
                           -0.7630909, -0.7709768, -0.7788712, -0.7863938, -0.7939261,
                           -0.80151045, -0.8071519, -0.8143384, -0.82151234, -0.82852924,
                           -0.83539665, -0.84224975, -0.84912115, -0.8557819, -0.8605028,
                           -0.86698234, -0.8732796, -0.8795563, -0.8856718, -0.89185333,
                           -0.89781034, -0.90376496, -0.9095548, -0.9153759, -0.9212331,
                           -0.9268911, -0.93240786, -0.9378533, -0.9433101, -0.9485688,
                           -0.9538408, -0.9589399, -0.9642453, -0.96922106, -0.97435814,
                           -0.9791167, -0.98406076, -0.98372495, -0.98853165, -0.99308693,
                           -0.9976613, -1.0021629, -1.0065238, -1.0109146, -1.0153291,
                           -1.0197116, -1.0238702, -1.0280595, -1.0321212, -1.0363084,
                           -1.0403392, -1.0443444, -1.0481286, -1.0520151, -1.0528646,
                           -1.0566292, -1.060204, -1.0638033, -1.0674521, -1.0711722,
                           -1.0747055, -1.0782821, -1.081787, -1.083765, -1.0873151,
                           -1.0907062, -1.0938468, -1.097062, -1.1002585, -1.1035814,
                           -1.1066762, -1.1097641, -1.1130087, -1.1159493, -1.119055,
                           -1.1219542, -1.1248387, -1.1279448, -1.13072, -1.1336114,
                           -1.1362557, -1.1362114, -1.1389217, -1.1416566, -1.1443094,
                           -1.146857, -1.1494592, -1.1521509, -1.1547623, -1.157095,
                           -1.1596451, -1.16219, -1.1634027, -1.1657462, -1.1680709,
                           -1.1703975, -1.1727817, -1.1751711, -1.1773854, -1.1797247,
                           -1.1819687, -1.1841689, -1.1863534, -1.1886253, -1.1895576,
                           -1.1918305, -1.1937962, -1.1959565, -1.1980559, -1.2000475,
                           -1.2022438, -1.2044119, -1.2061825, -1.208268, -1.2103329,
                           -1.2123001, -1.2140739, -1.2158449, -1.2178838, -1.219779,
                           -1.2216117, -1.22341, -1.2252687, -1.2271619, -1.2287366,
                           -1.2305583, -1.2322729, -1.2340301, -1.2356957, -1.2373065,
                           -1.2366962, -1.2383127, -1.2399846, -1.2415935, -1.2432598,
                           -1.2446462, -1.2463042, -1.2479992, -1.2495098, -1.2511556,
                           -1.2525661, -1.2540063, -1.2556546, -1.2571784, -1.258596,
                           -1.2600217, -1.260555, -1.2619663, -1.2634779, -1.2647252,
                           -1.2661624, -1.2675765, -1.2689209, -1.2703537, -1.2716234,
                           -1.2729348, -1.2743622, -1.2756051, -1.2768903, -1.2782557]],
                          dtype=np.float32)
        cls.beam_angle = xr.DataArray(data=bangle, coords={'time': [1495563079.5340009], 'beam': np.arange(400)})
        cls.tx_beam_width = 1.0
        cls.rx_beam_width = 1.3
        plength = np.array([[0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002, 0.002,
                            0.002, 0.002, 0.002, 0.002]], dtype=np.float32)
        cls.pulse_length = xr.DataArray(data=plength, coords={'time': [1495563079.5340009], 'beam': np.arange(400)})
        nncorr = np.array([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, -0.11169027, -0.3416195, -0.5374424, -0.71223235, -1.0023311,
                           -1.2839978, -1.4667435, -1.7569138, -2.0510612, -2.34331, -2.3936958,
                           -2.342616, 0.0, 0.0, 0.0, -1.9203914, -1.8113763,
                           -1.5293316, -1.3407072, -1.2092917, -0.86534995, -0.56182086, -0.45436418
                           -0.09631482, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                           0.0, 0.0, 0.0, 0.0, 0.0]], dtype=np.float32)
        cls.nearnormalcorrect = xr.DataArray(data=nncorr, coords={'time': [1495563079.5340009], 'beam': np.arange(400)})

    def setUp(self) -> None:
        self.bscatter = Allscatter(self.rdict, self.raw_intensity, self.slant_range, self.surface_sound_speed,
                                   self.beam_angle, self.tx_beam_width, self.rx_beam_width, self.nearnormalcorrect, self.pulse_length, None)
        self.rint_answer = -14.296875
        self.fgain_answer = 0.0
        self.areacorr_answer = 8.411084
        self.tvg_answer = 130.18085
        self.tlloss_answer = 130.18085

    def test_init(self):
        assert (self.bscatter.raw_intensity == self.raw_intensity).all()
        assert (self.bscatter.slant_range == self.slant_range).all()
        assert (self.bscatter.surface_sound_speed == self.surface_sound_speed).all()
        assert (self.bscatter.beam_angle == self.beam_angle).all()
        assert self.bscatter.runtime_parameters == self.rdict
        assert self.bscatter.absorption_db_m == float(self.bscatter.runtime_parameters['AbsorptionCoefficent']) / 1000
        assert self.bscatter.tx_beam_width == self.tx_beam_width
        assert self.bscatter.rx_beam_width == self.rx_beam_width
        assert (self.bscatter.pulse_length == self.pulse_length).all()

    def test_raw_intensity(self):
        assert np.allclose(self.bscatter.raw_intensity.values[0, 0], self.rint_answer)

    def test_area_correction(self):
        assert np.allclose(self.bscatter.area_correction.values[0, 0], self.areacorr_answer)

    def test_fixed_gain(self):
        assert self.bscatter.fixed_gain == self.fgain_answer

    def test_attenuation(self):
        assert np.allclose(self.bscatter.attenuation.values[0, 0], 17.162962)

    def test_spherical_spreading(self):
        assert np.allclose(self.bscatter.spherical_spreading.values[0, 0], 47.927461)

    def test_transmission_loss(self):
        assert np.allclose(self.bscatter.transmission_loss.values[0, 0], self.tlloss_answer)

    def test_tvg(self):
        assert np.allclose(self.bscatter.tvg.values[0, 0], self.tvg_answer)

    def test_process(self):
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False, transmission_loss_corrected=False, area_corrected=False).values[0, 0], self.rint_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False, transmission_loss_corrected=False).values[0, 0], self.rint_answer - self.areacorr_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False).values[0, 0], self.rint_answer - self.areacorr_answer + self.tlloss_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False).values[0, 0], self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer)
        assert np.allclose(self.bscatter.process().values[0, 0], self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer + self.fgain_answer)


class TestS7kscatter(unittest.TestCase):
    """
    Build arrays and metadata from the first ping in file T51_from_Reson\20210616_102930_0_Odin_T51_Port.s7k
    """
    @classmethod
    def setUpClass(cls) -> None:
        cls.rdict = {'auto_range_method': '0',
                     'auto_bottom_detection_filter_method': '0',
                     'bottom_detection_range_filter_enabled': 'False',
                     'bottom_detection_depth_filter_enabled': 'False',
                     'receiver_gain_autogain': 'False',
                     'receiver_gain_fixedgain': 'False',
                     'trigger_out_high': 'False',
                     'system_active': 'True',
                     'adaptive_search_window_passive': 'False',
                     'pipe_gating_filter_enabled': 'False',
                     'adaptive_gate_depth_filter_fixed': 'False',
                     'adaptive_gate_enabled': 'False',
                     'adaptive_gate_depth_filter_enabled': 'False',
                     'trigger_out_enabled': 'True',
                     'trigger_in_edge_negative': 'False',
                     'pps_edge_negative': 'False',
                     'timestamp_state_ok': 'True',
                     'depth_filter_follow_seafloor': 'True',
                     'reduced_coverage_for_constant_spacing': 'False',
                     'is_simulator': 'False',
                     'roll_compensation_indicator': 'True',
                     'heave_compensation_indicator': 'False',
                     'dynamic_focusing_method': '0',
                     'doppler_compensation_method': '0',
                     'match_filtering_method': '0',
                     'tvg_method': '0',
                     'multi_ping_number_of_pings': '0',
                     'TransmitBeamWidth': '0.51',
                     'ReceiveBeamWidth': '0.277',
                     'sonar_id': '0',
                     'PingNumber': '114708',
                     'MultiPingSequence': '0',
                     'Frequency': '800000.0',
                     'sample_rate_hertz': '34722.223',
                     'receiver_bandwidth_3db_hertz': '0.0',
                     'tx_pulse_width_seconds': '3e-05',
                     'tx_pulse_type_id': 'CW',
                     'tx_pulse_envelope_identifier': 'tukey',
                     'tx_pulse_envelope_parameter': '0.1',
                     'tx_single_multiping_mode': '16',
                     'TXPulseReserved': '0',
                     'maximum_ping_rate_per_second': '50.0',
                     'ping_period_seconds': '0.033898354',
                     'range_selection_meters': '23.0',
                     'power_selection_db_re_1micropascal': '219.0',
                     'gain_selection_db': '25.0',
                     'ControlFlags': '956334080',
                     'projector_selection': '1',
                     'ProjectorBeamSteeringAngleVertical': '0.0',
                     'ProjectorBeamSteeringAngleHorizontal': '0.0',
                     'ProjectorBeamWidthVertical': '0.008903361',
                     'ProjectorBeamWidthHorizontal': '2.86234',
                     'ProjectorBeamFocalPoint': '10000000.0',
                     'projector_weighting_window_type': 'rectangular',
                     'ProjectorBeamWeightingWindowParameter': '0.0',
                     'TransmitFlags': '0',
                     'hydrophone_identifier': '0',
                     'receiver_weighting_window_type': 'chebychev',
                     'ReceiveBeamWeightingParamter': '0.0',
                     'ReceiveFlags': '1',
                     'ReceiverBeamwidthHorizontal': '0.004829653',
                     'bottom_detect_filter_min_range': '0.1',
                     'bottom_detect_filter_max_range': '500.0',
                     'bottom_detect_filter_min_depth': '1.70137',
                     'bottom_detect_filter_max_depth': '4.07712',
                     'absorption_db_km': '250.0',
                     'sound_velocity_meters_per_sec': '1489.1276',
                     'spreading_loss_db': '30.0',
                     'ReservedFlag': '0',
                     'Counter': ''}
        rawrint = np.array([[50.65509 , 50.47493 , 55.973015, 57.20676 , 57.5359  , 56.839695,
                           52.340008, 47.1587  , 46.361267, 39.08485 , 41.43764 , 49.571327,
                           55.620735, 56.164223, 55.41704 , 53.36772 , 50.237663, 49.542427,
                           50.048542, 50.756382, 50.955498, 50.955498, 51.821293, 54.185402,
                           54.518234, 54.303345, 54.615646, 53.198322, 51.340527, 49.77101 ,
                           48.43208 , 47.604225, 46.966095, 49.12732 , 51.17417 , 51.434177,
                           50.237663, 51.48063 , 53.874542, 54.134354, 52.360962, 50.15712 ,
                           50.15712 , 49.03573 , 50.603996, 52.12763 , 51.22203 , 50.290955,
                           51.387478, 52.1491  , 52.213203, 52.506252, 55.49034 , 56.95145 ,
                           55.20845 , 52.319   , 54.336754, 54.759747, 52.649147, 52.749794,
                           55.238556, 55.086967, 51.909924, 50.70588 , 53.78618 , 55.79162 ,
                           54.065826, 50.70588 , 51.340527, 50.65509 , 50.343918, 54.43621 ,
                           55.178238, 52.506252, 51.88785 , 49.685997, 53.46042 , 51.663975,
                           51.549835, 52.749794, 55.283524, 57.80842 , 56.5732  , 57.37289 ,
                           54.791447, 57.48964 , 55.81977 , 54.031357, 53.515568, 54.26981 ,
                           50.603996, 50.021187, 54.979256, 52.360962, 52.444283, 55.298462,
                           55.010166, 54.80725 , 56.547386, 54.647873, 50.629578, 50.78152 ,
                           49.60014 , 51.245857, 56.443363, 57.26646 , 53.8921  , 51.75422 ,
                           50.78152 , 52.191887, 53.236256, 52.588192, 53.78618 , 57.218735,
                           53.962013, 50.264355, 50.831585, 52.084522, 51.663975, 51.931946,
                           51.798992, 51.17417 , 50.680523, 54.759747, 52.588192, 57.230686,
                           56.926743, 50.731167, 49.247963, 47.30976 , 50.15712 , 51.29332 ,
                           51.316956, 53.33036 , 51.48063 , 52.255676, 50.629578, 51.269623,
                           55.606346, 44.082397, 50.18405 , 52.88877 , 54.791447, 60.756496,
                           58.148228, 53.386337, 52.769783, 49.12732 , 54.469112, 52.381866,
                           59.39763 , 60.154957, 56.364517, 53.06425 , 53.1793  , 50.290955,
                           46.52672 , 43.917995, 51.909924, 46.48565 , 40.906456, 50.448883,
                           44.959465, 49.714428, 44.45433 , 51.821293, 47.494965, 47.92399 ,
                           51.503757, 55.22352 , 45.483154, 51.503757, 47.712128, 53.02556 ,
                           55.13272 , 52.547318, 47.712128, 51.387478, 51.798992, 48.723255,
                           49.455128, 52.423523, 51.572784, 48.691376, 53.58856 , 48.299465,
                           56.1236  , 50.237663, 47.53154 , 58.46488 , 53.00615 , 47.958797,
                           53.8921  , 52.82948 , 55.88976 , 43.167248, 51.731743, 47.04365 ,
                           50.075813, 47.27224 , 53.29284 , 50.370277, 54.599487, 52.084522,
                           52.749794, 54.631775, 49.06637 , 57.170746, 49.337353, 53.821632,
                           54.901497, 42.542095, 51.909924, 53.00615 , 48.818184, 55.283524,
                           49.366947, 56.177715, 55.02558 , 54.679985, 57.218735, 48.02801 ,
                           50.448883, 56.364517, 49.337353, 53.044926, 58.26568 , 61.69867 ,
                           51.663975, 53.36772 , 54.96376 , 53.821632, 50.78152 , 56.95145 ,
                           54.550823, 58.00734 , 55.73503 , 55.14792 , 49.06637 , 55.431747,
                           48.691376, 53.044926, 46.235077, 53.497223, 59.806778, 61.54009 ,
                           50.831585, 56.49553 , 58.820286, 55.49034 , 53.78618 , 48.46492 ,
                           52.68955 , 50.075813, 47.958797, 56.71381 , 49.96621 , 47.78332 ,
                           55.720825, 56.926743, 56.324825, 53.386337, 47.88903 , 51.52683 ,
                           48.23239 , 50.78152 , 55.59193 , 54.21926 , 58.01826 , 53.909637,
                           55.847836, 52.48564 , 54.083008, 46.848454, 57.5359  , 56.91436 ,
                           53.255157, 54.615646, 39.462555, 40.906456, 52.80963 , 47.120518,
                           54.917103, 54.80725 , 55.163094, 46.689075, 52.628876, 54.679985,
                           54.469112, 59.171276, 51.364037, 59.075195, 52.319   , 47.7478  ,
                           47.19671 , 48.366028, 42.79758 , 47.712128, 51.48063 , 53.1793  ,
                           51.549835, 53.660942, 53.478844, 52.17052 , 51.909924, 54.1514  ,
                           51.709213, 54.403187, 58.040054, 58.191116, 59.490234, 46.769127,
                           52.82948 , 55.41704 , 52.68955 , 56.852184, 57.254555, 54.452675,
                           54.386627, 56.25827 , 57.443127, 55.973015, 56.739136, 51.865723,
                           55.973015, 53.40492 , 56.028076, 58.730274, 54.014072, 55.283524,
                           51.663975, 55.46109 , 52.340008, 51.316956, 57.524357, 60.340668,
                           52.255676, 50.881363, 53.821632, 49.657475, 47.23456 , 50.955498,
                           54.014072, 54.74385 , 53.236256, 48.659386, 48.97413 , 47.53154 ,
                           53.497223, 51.150146, 49.03573 , 50.98007 , 52.084522, 45.529236,
                           44.86076 , 50.343918, 52.749794, 51.269623, 55.117496, 47.30976 ,
                           45.80069 , 50.603996, 48.265995, 49.60014 , 49.27786 , 52.381866,
                           49.307655, 47.676308, 49.77101 , 48.786655, 47.08217 , 52.908443,
                           52.191887, 51.843533, 53.44196 , 50.2109  , 43.167248, 45.105446,
                           49.06637 , 52.849293, 49.425835, 49.513428, 46.848454, 49.657475,
                           49.60014 , 50.603996, 48.595047, 49.27786 , 50.448883, 46.567593,
                           45.249023, 50.370277, 48.164803, 48.366028, 51.004566, 51.340527,
                           46.608276, 50.85651 , 50.075813, 49.0969  , 48.595047, 48.97413 ,
                           47.23456 , 52.213203, 51.75422 , 49.79917 , 50.831585, 51.07766 ,
                           51.340527, 52.588192, 50.930855, 49.455128, 51.07766 , 51.029   ,
                           51.004566, 54.485516, 53.16023 , 51.17417 , 51.52683 , 49.004982,
                           49.0969  , 49.79917 , 48.06241 , 53.1793  , 54.065826, 54.303345,
                           52.52681 , 48.659386, 47.640343, 50.048542, 53.85694 , 53.58856 ,
                           51.48063 , 50.31748 , 48.818184, 47.08217 , 48.096676, 47.23456 ,
                           48.366028, 48.366028, 46.192604, 48.19866 , 50.39656 , 49.455128,
                           50.603996, 51.316956, 49.0969  , 50.103   , 50.1301  , 47.88903 ,
                           48.06241 , 45.756035, 45.756035, 47.640343, 49.247963, 48.530228,
                           48.880898, 47.04365 , 48.164803, 47.1587  , 45.756035, 47.23456 ,
                           46.64877 , 46.0206  , 46.729195, 46.192604, 45.977062, 45.483154,
                           50.048542, 49.827232, 47.712128, 45.756035, 44.55773 , 44.959465,
                           44.86076 , 44.45433 , 44.45433 , 43.521824, 44.1903  , 43.40523 ,
                           40.172005, 41.7981  , 43.04577 , 42.67078 , 41.868435, 44.24375 ,
                           44.910255, 44.349678, 43.57954 , 44.760925, 45.05706 , 43.917995,
                           43.57954 , 43.463726, 43.57954 , 43.521824, 44.1903  , 43.86249 ,
                           42.542095, 41.583626, 41.583626, 41.138096, 41.289158, 39.36966 ,
                           39.735435, 39.735435, 39.08485 , 39.08485 , 39.18083 , 43.40523 ,
                           43.57954 , 41.583626]], dtype=np.float32)
        cls.raw_intensity = xr.DataArray(data=rawrint, coords={'time': [1623832163.411003], 'beam': np.arange(512)})
        slint = np.array([[14.998621 , 14.928927 , 14.873712 , 14.81725  , 14.754113 ,
                           14.684364 , 14.624603 , 14.566688 , 14.502157 , 14.4153595,
                           14.406918 , 14.289457 , 14.175664 , 14.089685 , 14.017669 ,
                           13.959616 , 13.899866 , 13.84736  , 13.79004  , 13.731475 ,
                           13.671659 , 13.61857  , 13.559827 , 13.497595 , 13.425228 ,
                           13.370786 , 13.32091  , 13.268977 , 13.220186 , 13.184984 ,
                           13.151153 , 13.085275 , 13.038252 , 12.985991 , 12.933343 ,
                           12.884398 , 12.817572 , 12.745016 , 12.676314 , 12.637944 ,
                           12.5703335, 12.524969 , 12.465134 , 12.396319 , 12.318183 ,
                           12.236555 , 12.150904 , 12.087841 , 12.03326  , 12.00954  ,
                           11.922963 , 11.8581915, 11.716374 , 11.671475 , 11.667489 ,
                           11.646135 , 11.629602 , 11.625683 , 11.596082 , 11.492833 ,
                           11.402437 , 11.372626 , 11.331043 , 11.267057 , 11.221552 ,
                           11.1633835, 11.12115  , 11.096247 , 11.071477 , 11.033226 ,
                           10.991718 , 10.94211  , 10.904455 , 10.863119 , 10.813715 ,
                           10.730639 , 10.628674 , 10.642077 , 10.6478195, 10.608259 ,
                           10.5752325, 10.51016  , 10.468189 , 10.445408 , 10.391828 ,
                           10.357293 , 10.339163 , 10.321307 , 10.290797 , 10.25978  ,
                           10.226082 , 10.193933 , 10.179507 , 10.164676 , 10.120166 ,
                           10.124639 , 10.069971 , 10.039359 , 10.02593  , 10.029603 ,
                            9.987416 ,  9.980093 ,  9.963041 ,  9.912849 ,  9.898967 ,
                            9.886582 ,  9.868008 ,  9.839698 ,  9.798822 ,  9.7758   ,
                            9.769897 ,  9.746487 ,  9.651089 ,  9.7008505,  9.680071 ,
                            9.635364 ,  9.575272 ,  9.558513 ,  9.556072 ,  9.529718 ,
                            9.53259  ,  9.512961 ,  9.485778 ,  9.472149 ,  9.398477 ,
                            9.415678 ,  9.41753  ,  9.3762865,  9.340863 ,  9.280675 ,
                            9.281184 ,  9.241955 ,  9.232869 ,  9.261615 ,  9.185279 ,
                            9.218621 ,  9.2116995,  9.165136 ,  9.169216 ,  9.071457 ,
                            9.126087 ,  9.113533 ,  9.084157 ,  9.07518  ,  9.074004 ,
                            9.033806 ,  9.000215 ,  8.996019 ,  8.998868 ,  8.978667 ,
                            8.960875 ,  8.949102 ,  8.927557 ,  8.911769 ,  8.829352 ,
                            8.791772 ,  8.776308 ,  8.73886  ,  8.802087 ,  8.477188 ,
                            8.579958 ,  8.716043 ,  8.563225 ,  8.6561775,  8.579237 ,
                            8.68551  ,  8.637978 ,  8.632332 ,  8.628144 ,  8.601854 ,
                            8.570943 ,  8.558597 ,  8.520906 ,  8.5255165,  8.520935 ,
                            8.494633 ,  8.457888 ,  8.463818 ,  8.4333105,  8.416005 ,
                            8.415913 ,  8.4165125,  8.398542 ,  8.379464 ,  8.378074 ,
                            8.3473835,  8.347808 ,  8.341752 ,  8.319793 ,  8.294002 ,
                            8.251361 ,  8.226545 ,  8.252141 ,  8.230044 ,  8.208027 ,
                            8.162078 ,  8.141638 ,  8.189049 ,  8.165375 ,  8.150487 ,
                            8.139003 ,  8.122384 ,  8.128143 ,  8.080749 ,  8.094934 ,
                            8.083435 ,  8.044344 ,  8.062123 ,  8.049471 ,  8.037375 ,
                            8.031553 ,  8.013925 ,  8.00353  ,  7.990506 ,  7.966052 ,
                            7.9646544,  7.9494843,  7.9485927,  7.943837 ,  7.9240656,
                            7.91376  ,  7.901766 ,  7.9184303,  7.895554 ,  7.8629465,
                            7.874538 ,  7.870655 ,  7.864106 ,  7.86508  ,  7.844147 ,
                            7.8252225,  7.832079 ,  7.797753 ,  7.812832 ,  7.7943187,
                            7.7918444,  7.78995  ,  7.7860346,  7.779562 ,  7.7801437,
                            7.780271 ,  7.7624207,  7.7319107,  7.7536793,  7.738716 ,
                            7.7350554,  7.733645 ,  7.726433 ,  7.7245545,  7.719948 ,
                            7.7034755,  7.7084556,  7.714615 ,  7.6980104,  7.6967626,
                            7.6896877,  7.687881 ,  7.7073817,  7.703148 ,  7.689164 ,
                            7.6944537,  7.699012 ,  7.6978335,  7.680906 ,  7.6792545,
                            7.685882 ,  7.676767 ,  7.6849093,  7.6883507,  7.669006 ,
                            7.670899 ,  7.683185 ,  7.664575 ,  7.6853905,  7.671289 ,
                            7.6594954,  7.65695  ,  7.6547484,  7.6678414,  7.6813965,
                            7.6697493,  7.6696105,  7.6636496,  7.6609445,  7.659491 ,
                            7.6602783,  7.659481 ,  7.6578197,  7.645079 ,  7.660203 ,
                            7.665402 ,  7.6718473,  7.6785517,  7.6917744,  7.6827216,
                            7.692356 ,  7.7153916,  7.69474  ,  7.6927915,  7.7085595,
                            7.711244 ,  7.718084 ,  7.735078 ,  7.7247257,  7.739098 ,
                            7.739912 ,  7.7700872,  7.773855 ,  7.782713 ,  7.774784 ,
                            7.790727 ,  7.7993746,  7.8060713,  7.824993 ,  7.8334427,
                            7.846911 ,  7.8530016,  7.879274 ,  7.892838 ,  7.915509 ,
                            7.924188 ,  7.948305 ,  7.969509 ,  7.983701 ,  8.012084 ,
                            8.017867 ,  8.051197 ,  8.070837 ,  8.092955 ,  8.117928 ,
                            8.145933 ,  8.179582 ,  8.234338 ,  8.271096 ,  8.297738 ,
                            8.321997 ,  8.356771 ,  8.389054 ,  8.430117 ,  8.463406 ,
                            8.494214 ,  8.539589 ,  8.566424 ,  8.599775 ,  8.626663 ,
                            8.672126 ,  8.71386  ,  8.758036 ,  8.7778635,  8.8126955,
                            8.853605 ,  8.894349 ,  8.926409 ,  8.966301 ,  9.019939 ,
                            9.0487795,  9.063832 ,  9.109287 ,  9.155859 ,  9.18379  ,
                            9.241822 ,  9.272135 ,  9.301838 ,  9.359251 ,  9.380844 ,
                            9.417929 ,  9.434157 ,  9.499147 ,  9.5238905,  9.559139 ,
                            9.592112 ,  9.633659 ,  9.6690645,  9.720498 ,  9.733321 ,
                            9.756385 ,  9.817479 ,  9.852613 ,  9.879757 ,  9.905319 ,
                            9.948536 , 10.00076  , 10.03382  , 10.077104 , 10.107804 ,
                           10.130134 , 10.185326 , 10.235892 , 10.251705 , 10.298341 ,
                           10.334438 , 10.376514 , 10.410993 , 10.449152 , 10.496748 ,
                           10.558667 , 10.608014 , 10.656997 , 10.682023 , 10.712236 ,
                           10.755307 , 10.806453 , 10.85848  , 10.904331 , 10.941179 ,
                           10.9676485, 10.997826 , 11.052247 , 11.119624 , 11.182936 ,
                           11.233022 , 11.270576 , 11.300568 , 11.34418  , 11.39436  ,
                           11.451864 , 11.505238 , 11.546835 , 11.592916 , 11.645482 ,
                           11.696198 , 11.745637 , 11.791763 , 11.841563 , 11.887397 ,
                           11.937658 , 11.988856 , 12.0416565, 12.08673  , 12.133603 ,
                           12.184019 , 12.242011 , 12.292904 , 12.345383 , 12.397399 ,
                           12.46099  , 12.523498 , 12.579008 , 12.637352 , 12.708988 ,
                           12.777043 , 12.851397 , 12.92919  , 13.00153  , 13.069834 ,
                           13.143694 , 13.219546 , 13.29577  , 13.371582 , 13.440738 ,
                           13.50968  , 13.594376 , 13.670045 , 13.759953 , 13.838979 ,
                           13.918986 , 13.997765 , 14.075315 , 14.15277  , 14.240897 ,
                           14.332488 , 14.414844 , 14.503163 , 14.583327 , 14.668094 ,
                           14.757447 , 14.841423 , 14.930545 , 15.019282 , 15.1032   ,
                           15.181519 , 15.265974 , 15.355973 , 15.443259 , 15.535277 ,
                           15.6201105, 15.710398 , 15.800315 , 15.891245 , 15.986777 ,
                           16.072365 , 16.161865 , 16.243086 , 16.340437 , 16.422806 ,
                           16.514992 , 16.602976 , 16.690605 , 16.786722 , 16.876389 ,
                           16.970661 , 17.059807 , 17.158339 , 17.25518  , 17.356644 ,
                           17.446241 , 17.537212 , 17.620773 , 17.711561 , 17.798513 ,
                           17.88737  , 17.99377  , 18.102116 , 18.201202 , 18.304886 ,
                           18.407808 , 18.49967  , 18.603302 , 18.699022 , 18.792147 ,
                           18.88178  , 18.97924  ]], dtype=np.float32)
        cls.slant_range = xr.DataArray(data=slint, coords={'time': [1623832163.411003], 'beam': np.arange(512)})
        cls.surface_sound_speed = xr.DataArray(data=np.array([1489.084], dtype=np.float32),
                                               coords={'time': [1623832163.411003]})
        bangle = np.array([[ 1.1321402 ,  1.1295266 ,  1.1270872 ,  1.1246474 ,  1.1220337 ,
                            1.11942   ,  1.1169809 ,  1.1143671 ,  1.1117535 ,  1.1091398 ,
                            1.1065258 ,  1.1039116 ,  1.1012979 ,  1.0986836 ,  1.0958955 ,
                            1.0932815 ,  1.0904932 ,  1.0878793 ,  1.085091  ,  1.0823029 ,
                            1.0795149 ,  1.0769002 ,  1.0741115 ,  1.0713227 ,  1.0683601 ,
                            1.065572  ,  1.0627838 ,  1.0598214 ,  1.0570333 ,  1.0540707 ,
                            1.051282  ,  1.0483193 ,  1.0453565 ,  1.0423939 ,  1.0394311 ,
                            1.036469  ,  1.0335064 ,  1.030544  ,  1.0274065 ,  1.0244441 ,
                            1.0213071 ,  1.0183445 ,  1.0152075 ,  1.0120704 ,  1.0089335 ,
                            1.0057963 ,  1.0026593 ,  0.99952203,  0.9963848 ,  0.9932477 ,
                            0.98993653,  0.9867994 ,  0.9834878 ,  0.98017585,  0.97703826,
                            0.97372633,  0.97041446,  0.96710247,  0.96379113,  0.9603051 ,
                            0.95699334,  0.9536813 ,  0.9501949 ,  0.9468831 ,  0.9433969 ,
                            0.9399111 ,  0.9364249 ,  0.9329392 ,  0.92945343,  0.9259675 ,
                            0.9224819 ,  0.9188215 ,  0.9153356 ,  0.9116756 ,  0.9081902 ,
                            0.90452975,  0.9008693 ,  0.8972089 ,  0.89354837,  0.8898885 ,
                            0.88622814,  0.8823934 ,  0.878733  ,  0.8748985 ,  0.8712381 ,
                            0.86740386,  0.8635695 ,  0.8597351 ,  0.8559003 ,  0.85206586,
                            0.84823185,  0.8443977 ,  0.8403891 ,  0.8365545 ,  0.8325455 ,
                            0.8285369 ,  0.82487714,  0.82086885,  0.8168602 ,  0.8128514 ,
                            0.8086684 ,  0.80465966,  0.80065113,  0.7964683 ,  0.792459  ,
                            0.78827673,  0.784094  ,  0.7799109 ,  0.77572745,  0.7715452 ,
                            0.76736236,  0.76317966,  0.75882274,  0.75464046,  0.7502838 ,
                            0.7461005 ,  0.74174386,  0.73738706,  0.7330306 ,  0.72867405,
                            0.72431743,  0.7199607 ,  0.71543026,  0.71107435,  0.70654345,
                            0.7021867 ,  0.6976564 ,  0.6931257 ,  0.68859583,  0.68406546,
                            0.6795354 ,  0.6750051 ,  0.6703009 ,  0.6657708 ,  0.6610671 ,
                            0.656537  ,  0.65165913,  0.6469544 ,  0.64225006,  0.63754636,
                            0.6328437 ,  0.62813926,  0.62343657,  0.61855865,  0.6138551 ,
                            0.60897756,  0.60410076,  0.5993975 ,  0.5945202 ,  0.58964354,
                            0.5847668 ,  0.5798899 ,  0.57483906,  0.56996286,  0.5650865 ,
                            0.5600362 ,  0.5551604 ,  0.55011034,  0.5450604 ,  0.5400106 ,
                            0.5349618 ,  0.52991223,  0.52486324,  0.5198144 ,  0.5147656 ,
                            0.5097183 ,  0.5044955 ,  0.4994477 ,  0.49422562,  0.48900378,
                            0.48378277,  0.47873652,  0.4735154 ,  0.4682945 ,  0.4630742 ,
                            0.45768094,  0.45246124,  0.44724178,  0.44184923,  0.43663025,
                            0.4312383 ,  0.4260205 ,  0.4206289 ,  0.41523874,  0.4098482 ,
                            0.40445924,  0.39907002,  0.39368105,  0.3882934 ,  0.38290608,
                            0.37751842,  0.3719585 ,  0.36657226,  0.36101365,  0.35545552,
                            0.34989846,  0.34434175,  0.3389597 ,  0.3334049 ,  0.32785153,
                            0.3222984 ,  0.31674695,  0.3111968 ,  0.30564737,  0.30009878,
                            0.29437935,  0.28883374,  0.2832899 ,  0.2775749 ,  0.27203405,
                            0.26632297,  0.26078558,  0.25507832,  0.24954581,  0.24384332,
                            0.2381432 ,  0.23261833,  0.2269243 ,  0.22123301,  0.21554613,
                            0.20986235,  0.20418334,  0.19850826,  0.19283867,  0.18717384,
                            0.18151498,  0.17569208,  0.17004716,  0.16441011,  0.15878189,
                            0.15299308,  0.1473856 ,  0.14179003,  0.13603902,  0.1304729 ,
                            0.12475646,  0.11922824,  0.11355662,  0.10807836,  0.10246623,
                            0.09705544,  0.09152544,  0.0862093 ,  0.08079541,  0.07545948,
                            0.07037175,  0.06524718,  0.06027043,  0.05562007,  0.05106556,
                            0.04682124,  0.04308403, -0.03974211, -0.03705466, -0.0352143 ,
                           -0.03424013, -0.03428006, -0.03533065, -0.03723657, -0.03998041,
                           -0.04336667, -0.04713786, -0.05140984, -0.05598545, -0.06065178,
                           -0.06564105, -0.07077622, -0.07587159, -0.08121455, -0.0866338 ,
                           -0.09195423, -0.09748828, -0.10290194, -0.10851717, -0.11399782,
                           -0.11967182, -0.12520146, -0.13092017, -0.13648868, -0.14224029,
                           -0.14783704, -0.15344584, -0.15923548, -0.16486454, -0.17050242,
                           -0.17614806, -0.18197215, -0.1876316 , -0.19329691, -0.19896746,
                           -0.20464277, -0.21032286, -0.216007  , -0.22169507, -0.22738671,
                           -0.23308194, -0.23860669, -0.24430728, -0.25001144, -0.2555443 ,
                           -0.26125264, -0.2667899 , -0.27250242, -0.27804303, -0.28375888,
                           -0.28930342, -0.2948494 , -0.30057   , -0.3061185 , -0.31166863,
                           -0.31721973, -0.32277226, -0.3283254 , -0.33388042, -0.33943582,
                           -0.34481883, -0.35037577, -0.35593367, -0.36131847, -0.36687803,
                           -0.37226486, -0.37782586, -0.38321352, -0.38860226, -0.3939911 ,
                           -0.3993808 , -0.4047711 , -0.4101622 , -0.4155532 , -0.4209447 ,
                           -0.426337  , -0.43155587, -0.43694878, -0.4421686 , -0.44756246,
                           -0.4527825 , -0.45800328, -0.4633981 , -0.46861959, -0.4738412 ,
                           -0.47906268, -0.48411083, -0.4893335 , -0.49455607, -0.4997791 ,
                           -0.5046545 , -0.5098778 , -0.5149275 , -0.51997757, -0.52502775,
                           -0.5300782 , -0.53512895, -0.54017925, -0.5452299 , -0.5502815 ,
                           -0.5553329 , -0.5602099 , -0.5652617 , -0.5701393 , -0.5750169 ,
                           -0.58006907, -0.5849472 , -0.5898255 , -0.5947035 , -0.59958214,
                           -0.6042869 , -0.609165  , -0.6140439 , -0.61874914, -0.6236282 ,
                           -0.6283331 , -0.63303804, -0.63774335, -0.64244854, -0.64715356,
                           -0.6518594 , -0.65656483, -0.6610963 , -0.66580194, -0.6703338 ,
                           -0.6750398 , -0.6795713 , -0.6841033 , -0.6886354 , -0.6931676 ,
                           -0.69769996, -0.7022318 , -0.7065897 , -0.71112245, -0.71548   ,
                           -0.7200127 , -0.72437066, -0.7287283 , -0.7330868 , -0.7374451 ,
                           -0.74180317, -0.7461614 , -0.75034565, -0.7547048 , -0.7588889 ,
                           -0.76324767, -0.7674318 , -0.77161634, -0.7758006 , -0.7799847 ,
                           -0.78416955, -0.78835416, -0.7925389 , -0.79654896, -0.80073375,
                           -0.80474395, -0.80875456, -0.81293947, -0.81695014, -0.8209605 ,
                           -0.82497114, -0.82880723, -0.8326438 , -0.83665454, -0.840491  ,
                           -0.84450203, -0.8483384 , -0.8521749 , -0.8560114 , -0.8598482 ,
                           -0.8636852 , -0.8675214 , -0.8713584 , -0.8750217 , -0.8788588 ,
                           -0.882522  , -0.88635945, -0.8900224 , -0.8936852 , -0.89734805,
                           -0.9010111 , -0.90467393, -0.908336  , -0.91182536, -0.915488  ,
                           -0.9189761 , -0.9226386 , -0.92612696, -0.9296163 , -0.933105  ,
                           -0.93659365, -0.94008255, -0.94357145, -0.9470605 , -0.9503751 ,
                           -0.95386404, -0.9571785 , -0.9604929 , -0.96398216, -0.96747106,
                           -0.9707857 , -0.97410035, -0.9774151 , -0.9805551 , -0.9838696 ,
                           -0.98718435, -0.9903247 , -0.9936396 , -0.99677956, -0.9999198 ,
                           -1.0030601 , -1.0062006 , -1.0093417 , -1.0124815 , -1.0156227 ,
                           -1.018764  , -1.021731  , -1.0248712 , -1.0278373 , -1.0309778 ,
                           -1.0339439 , -1.0369105 , -1.0398769 , -1.0428431 , -1.04581   ,
                           -1.048777  , -1.0517445 , -1.0545368 , -1.0575042 , -1.0602968 ,
                           -1.0632638 , -1.0660567 , -1.06885   , -1.0718179 , -1.0746114 ,
                           -1.0774049 , -1.0800234 , -1.0828162 , -1.0856087 , -1.0884016 ,
                           -1.09102   , -1.0938134 , -1.0964329 , -1.0992267 , -1.101845  ,
                           -1.1044649 , -1.1070831 , -1.1097016 , -1.1123197 , -1.1149377 ,
                           -1.1175549 , -1.1199982 , -1.122616  , -1.1252339 , -1.1276774 ,
                           -1.1301206 , -1.1327382 ]], dtype=np.float32)
        cls.beam_angle = xr.DataArray(data=bangle, coords={'time': [1623832163.411003], 'beam': np.arange(512)})
        cls.tx_beam_width = 0.51
        cls.rx_beam_width = 0.277

    def setUp(self) -> None:
        self.bscatter = S7kscatter(self.rdict, self.raw_intensity, self.slant_range, self.surface_sound_speed,
                                   self.beam_angle, self.tx_beam_width, self.rx_beam_width, None)
        self.rint_answer = 50.65509
        self.fgain_answer = 244.0
        self.areacorr_answer = -24.822943
        self.tvg_answer = 78.06239
        self.tlloss_answer = 54.541363

    def test_init(self):
        assert (self.bscatter.raw_intensity == self.raw_intensity).all()
        assert (self.bscatter.slant_range == self.slant_range).all()
        assert (self.bscatter.surface_sound_speed == self.surface_sound_speed).all()
        assert (self.bscatter.beam_angle == self.beam_angle).all()
        assert self.bscatter.runtime_parameters == self.rdict
        assert self.bscatter.absorption_db_m == float(self.bscatter.runtime_parameters['absorption_db_km']) / 1000
        assert self.bscatter.spreading_loss_db == float(self.bscatter.runtime_parameters['spreading_loss_db'])
        assert self.bscatter.power_selection_db_re_1micropascal == float(self.bscatter.runtime_parameters['power_selection_db_re_1micropascal'])
        assert self.bscatter.pulse_length == float(self.bscatter.runtime_parameters['tx_pulse_width_seconds'])
        assert self.bscatter.gain_selection_db == float(self.bscatter.runtime_parameters['gain_selection_db'])
        assert self.bscatter.tx_beam_width == self.tx_beam_width
        assert self.bscatter.rx_beam_width == self.rx_beam_width

    def test_raw_intensity(self):
        assert np.allclose(self.bscatter.raw_intensity.values[0, 0], self.rint_answer)

    def test_area_correction(self):
        assert np.allclose(self.bscatter.area_correction.values[0, 0], self.areacorr_answer)

    def test_fixed_gain(self):
        assert np.allclose(self.bscatter.fixed_gain, self.fgain_answer)

    def test_attenuation(self):
        assert np.allclose(self.bscatter.attenuation.values[0, 0], 3.7496552)

    def test_spherical_spreading(self):
        assert np.allclose(self.bscatter.spherical_spreading.values[0, 0], 23.521027)

    def test_transmission_loss(self):
        assert np.allclose(self.bscatter.transmission_loss.values[0, 0], self.tlloss_answer)

    def test_tvg(self):
        assert np.allclose(self.bscatter.tvg.values[0, 0], self.tvg_answer)

    def test_process(self):
        assert np.allclose(
            self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False, transmission_loss_corrected=False,
                                  area_corrected=False).values[0, 0], self.rint_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False,
                                                 transmission_loss_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer)
        assert np.allclose(self.bscatter.process().values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer - self.fgain_answer)


class TestKmallscatter(unittest.TestCase):
    """
    Build arrays and metadata from the first ping in file EM2040_KMALL_fromkongs\0039_20200428_115408_ShipName.kmall
    """
    @classmethod
    def setUpClass(cls) -> None:
        cls.rdict = {'Max angle Port': '65.0',
                     'Max angle Starboard': '65.0',
                     'Max coverage Port': '2000.0',
                     'Max coverage Starboard': '2000.0',
                     'Angular coverage Mode': 'Auto',
                     'Beam spacing': 'Equidistance',
                     'Forced depth': '--',
                     'Min. depth': '2.0',
                     'Max. depth': '1000.0',
                     'Dual swath': 'Dynamic',
                     'Depth setting': 'Auto',
                     'FM disable': 'Off',
                     'Water column data': 'On',
                     'Pitch stabilisation': 'On',
                     'Transmit angle Along': '0.0',
                     'External Trigger': 'Off',
                     'Yaw Stabilisation Mode': 'Rel. mean heading',
                     'Yaw Stabilisation Heading Filter': 'Medium',
                     '3D Scanning Enable': 'Off',
                     'Sound Velocity source': 'Profile',
                     'Spike filter strength': 'Medium',
                     'Range gate size': 'Normal',
                     'Phase ramp': 'Normal',
                     'Penetration Filter Strength': 'Off',
                     'Slope': 'On',
                     'Aeration': 'Off',
                     'Interference': 'Off',
                     'Normal incidence corr.': '10.0',
                     "Use Lambert's law": 'On',
                     'Transmit power level': 'Normal',
                     'Soft startup': '0',
                     'Water Column': 'On',
                     'Water column': '30 dB Offset',
                     'Water phase data': 'Off',
                     'Sonar mode': 'Off',
                     'Extra detection': 'Off',
                     'Enable Simulation': 'Off',
                     'Scope display enabled': 'Off',
                     'Counter': ''}
        rawrint = np.array([[14.537903, 20.624405, 13.011002, 8.065971, 11.1410675,
                             12.789299, 11.081467, 9.878387, 12.586609, 10.822655,
                             9.857201, 11.554947, 14.47818, 14.616272, 16.607758,
                             17.486206, 17.546906, 17.574799, 17.602707, -46.650314,
                             6.5060425, 9.33847, 11.176956, 15.217201, 14.878288,
                             12.534729, 13.342522, 13.213135, 11.645889, 10.238808,
                             5.0815735, -45.993988, -46.14276, 9.490067, 12.517944,
                             16.369766, 16.312302, 14.596802, 11.728409, 8.646362,
                             5.7761536, 7.4183044, 7.477417, 12.705017, 16.622284,
                             19.232239, 20.471916, 19.134605, 19.067337, 20.249092,
                             18.857529, 16.841873, 15.816681, 16.615372, 16.63321,
                             17.738754, 16.989166, 16.067047, 16.899796, 19.70253,
                             17.977982, 19.697144, 19.664444, 17.596268, 15.030655,
                             15.599716, 18.829727, 20.877106, 20.778229, 19.12445,
                             16.23581, 16.245995, 11.419121, 14.783157, 17.130371,
                             19.87091, 22.137604, 22.087303, 20.431442, 17.760185,
                             15.106209, 14.965309, 14.758781, 14.777817, 13.88472,
                             15.100502, 17.492981, 19.813461, 19.955338, 20.057747,
                             22.570824, 23.308914, 24.290947, 23.32946, -36.915817,
                             21.864777, 19.099312, 17.260033, -33.371056, -31.56556,
                             15.177658, 15.396393, 15.614639, 18.134193, 20.902687,
                             -27.881462, -27.728104, -27.62593, -27.518715, -27.350037,
                             -27.232193, -27.108978, -26.923988, -26.789986, -26.650574,
                             -26.505356, -26.297165, 13.971809, 10.52739, 12.262695,
                             15.928696, 15.87822, 19.766052, 18.447693, 19.393105,
                             19.501656, 19.372772, 20.254738, 20.809265, 19.625694,
                             19.384918, 18.160034, 18.959267, 20.393341, 20.005966,
                             17.590057, 14.634628, 13.831116, 13.683853, 15.974915,
                             16.0419, 18.244186, 18.236168, 19.53144, 19.418037,
                             19.278244, 19.080185, 18.52813, 18.79741, 20.426216,
                             20.342346, 20.521996, 20.560333, 18.945374, 14.790512,
                             19.292587, 15.33638, 14.941109, 17.48996, 13.539894,
                             14.704132, 15.177414, 18.03112, 19.096199, 19.047958,
                             17.489677, 18.576454, 19.102562, 17.669342, 19.577087,
                             20.084885, 23.717743, 24.212479, 24.495644, 25.80217,
                             25.76857, 25.678825, 25.25227, 25.35265, 25.838654,
                             27.53128, 28.135277, 24.138718, 24.94941, 29.310555,
                             25.91027, -30.60836, 20.676682, 25.38459, 17.199005,
                             28.901558, 31.698006, 32.10298, 32.30838, 32.29239,
                             32.071304, 31.640678, 30.10698, 22.030159, -32.581963,
                             22.296013, 21.505684, 20.454887, 23.063736, 22.61811,
                             22.853745, 26.2137, 30.080582, 32.229836, 18.15866,
                             31.635918, 32.661682, 31.74646, 31.814064, 31.896759,
                             31.894196, 31.251312, 31.332027, 31.498966, -33.09017,
                             31.524574, 31.305279, 30.911053, 30.340298, 29.530827,
                             29.911545, 28.443565, 26.310738, 26.32862, 27.439827,
                             30.217869, 32.69125, 27.016083, 18.513893, 26.728333,
                             25.649757, 27.112125, 27.067097, 28.738998, 25.584587,
                             30.23259, 30.492676, 34.76169, 30.329742, -29.427887,
                             33.878975, 29.706863, 28.886108, 30.194054, 30.573128,
                             34.300358, 36.567833, 38.329414, 37.02645, 33.508236,
                             39.460155, 45.994724, 45.88231, 44.377502, 39.767975,
                             34.84572, 33.10386, 30.674335, 33.586746, 33.355843,
                             33.10933, 32.76143, 32.37677, 32.936134, 32.420715,
                             32.156464, 31.638847, 31.055191, 30.859634, 28.657066,
                             25.64043, 15.139961, 20.678764, 27.902824, 26.310081,
                             27.369553, 28.406296, 29.313278, 30.021812, 30.52378,
                             30.803116, 30.854942, 31.120567, 27.145073, 30.482582,
                             30.010986, 29.46254, 28.83583, 28.163406, 27.81144,
                             19.69017, 21.357864, 22.41845, 23.493294, 22.78991,
                             21.091309, 19.31884, 18.190765, 18.406418, 22.20391,
                             23.40195, 23.936867, 22.739197, 25.34974, 25.107162,
                             25.891014, 23.46917, 26.303314, 28.144432, 28.621586,
                             28.622658, 27.485054, 23.491882, 18.558434, 28.549568,
                             22.973778, 19.367958, 19.62561, 19.874115, 19.02201,
                             19.672104, 19.124458, 22.171997, 22.84021, 23.424988,
                             23.788742, 23.9273, 23.790962, 23.597664, 21.599823,
                             22.257996, 22.471985, 22.645325, 26.303463, 26.528889,
                             28.112305, 27.097527, 24.376732, 21.811378, 21.982605,
                             22.031815, 20.39032, 20.33944, 20.107117, 20.375679,
                             20.639168, 23.07193, 23.291595, 26.15435, 26.274101,
                             28.280228, 29.1428, 29.14003, 29.161201, 29.156044,
                             28.605244, 27.9696, 28.007835, 27.562462, 27.535355,
                             27.04681, 27.058956, 26.357315, 26.388649, 25.531021,
                             24.619339, 24.827576, 24.993835, 24.533302, 24.729118,
                             24.40622, 24.557724, 23.759628, 22.426529, 22.5391,
                             21.379135, 20.756195, 19.515419, 19.59243, 16.992294,
                             15.581345, 19.261566, 15.878609, 15.573547, 15.603622,
                             15.239143, 16.290703, 17.371819, 16.513405, 17.109085,
                             20.219078, 25.095802, 23.554993, 19.243233, -7.368248,
                             -45.96376, -46.098114, -46.1409, -46.178513, -46.21103,
                             -46.238785, -46.261993, -46.28093, -46.295853, -46.395782,
                             -46.403503, -46.40764, -46.408264, 7.172043, 9.878471,
                             -46.868835, -46.86154, -46.85103, -46.837326, -46.820465,
                             -46.80046, -46.777466, -46.66104, -46.632034, -46.600372,
                             18.565384, 14.957916, 18.49582, -47.10843, 18.294449,
                             -47.085068, -46.95874, 14.303909, 18.46991, 18.658722,
                             21.134567, 21.527458, 21.46025, 18.894493, 15.912491,
                             17.306763, 21.53595, 23.340805, 22.428902, 19.18077,
                             10.108994, 14.324753, 9.934952, 9.815567, 9.69516,
                             7.824707, 7.6907806, 9.284416, 13.840164, 13.960312,
                             18.457787, 18.5495, 21.20504, 22.379272, 22.408485,
                             21.987457, 21.72647, 19.349113, 13.331734, 13.888184,
                             -47.851486, 14.064072, 14.885277, 14.092224, 15.256256,
                             18.177933, 20.31569, 19.26976, 17.204521, 15.546753,
                             15.462311, 14.270554, 13.517044, 14.597992, 17.057999,
                             18.858307, 18.855995, 18.96846, 17.772713, 15.3734665,
                             15.304367, 12.976639, 13.815689, 15.102417, 15.4058075,
                             14.669449, 14.715858, 18.148949, 16.095695, 17.873482,
                             15.819885, 13.311485, 11.374786, 12.823288, 16.282974,
                             18.892921, 20.006927, 20.149918, 16.823318, 14.223434,
                             12.9058075, 13.958694, 15.186485, 16.373245, 17.181946,
                             16.490326, 14.235741]], dtype=np.float32)
        cls.raw_intensity = xr.DataArray(data=rawrint, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        slint = np.array([[337.82657, 336.32956, 335.1055, 331.49707, 328.10287, 328.6143,
                           328.1204, 327.07712, 328.61053, 327.62897, 326.62958, 325.88947,
                           325.15665, 324.4494, 323.906, 323.5621, 323.45688, 323.05038,
                           323.39035, 323.8628, 324.27954, 323.0319, 321.91116, 320.17618,
                           318.02676, 315.79077, 316.83475, 316.7058, 315.23294, 313.8363,
                           312.32755, 313.14355, 313.9547, 314.75705, 308.95367, 308.65817,
                           308.9045, 304.38876, 303.7643, 302.7601, 301.80466, 301.28854,
                           300.49637, 299.6374, 298.90237, 298.24344, 297.61554, 298.4321,
                           298.76895, 296.3968, 295.2038, 294.3364, 293.53348, 292.74466,
                           291.93253, 290.94888, 289.89282, 288.69577, 286.73907, 285.13144,
                           282.8003, 284.53888, 283.72958, 282.85104, 281.94025, 280.9224,
                           279.89166, 278.8727, 277.77142, 277.11133, 276.95886, 276.097,
                           274.56577, 273.06543, 271.6912, 270.59473, 269.57285, 268.0438,
                           266.67093, 266.51022, 264.9753, 265.703, 265.41373, 264.67682,
                           263.72562, 262.77332, 262.05527, 261.78003, 261.69922, 261.6378,
                           260.6665, 259.86472, 258.76236, 257.60883, 256.8877, 256.16986,
                           255.37225, 254.46674, 253.68274, 252.9022, 252.1243, 252.12024,
                           251.562, 250.91098, 250.17357, 249.89772, 249.62267, 249.34874,
                           249.07489, 248.80225, 248.52988, 248.26, 247.99002, 247.72087,
                           247.45293, 247.18636, 246.92104, 246.63794, 240.94795, 240.0933,
                           239.47743, 238.81082, 237.91115, 237.98166, 236.88281, 236.41629,
                           235.96965, 235.32358, 234.55206, 233.81926, 233.06775, 232.29095,
                           231.35864, 230.46397, 229.76251, 229.18039, 228.22441, 226.77483,
                           227.1424, 226.18355, 225.67532, 224.97804, 224.5899, 224.57161,
                           224.34973, 223.74529, 222.9941, 222.23106, 221.44499, 219.1716,
                           218.75444, 218.51181, 217.93361, 217.23576, 217.08125, 219.10611,
                           220.85489, 217.8294, 221.82646, 217.34991, 217.06552, 216.91507,
                           220.96974, 222.42305, 222.30244, 217.76302, 213.03812, 213.78615,
                           212.81143, 212.09282, 211.56097, 210.89809, 211.11365, 210.73322,
                           210.38367, 210.13835, 209.7323, 209.19408, 208.69348, 208.13509,
                           207.66771, 207.84334, 204.49121, 210.17075, 206.31578, 209.77913,
                           207.65054, 205.53004, 205.37003, 208.0879, 203.28009, 203.22119,
                           203.18105, 203.14542, 203.11243, 203.09392, 203.09175, 203.10564,
                           206.38808, 203.60027, 200.82352, 200.92049, 200.67113, 201.29381,
                           202.08397, 201.7784, 199.22849, 199.07555, 198.91364, 194.93036,
                           197.38994, 198.44089, 198.98427, 199.45927, 198.73047, 198.93999,
                           198.61455, 200.1659, 200.06963, 199.94235, 199.8202, 199.83203,
                           199.9141, 200.12616, 200.24701, 199.71663, 197.72406, 197.2955,
                           199.30222, 196.13892, 195.37386, 194.40129, 196.07362, 200.53346,
                           200.9869, 196.75658, 195.38716, 196.04643, 196.2766, 192.43051,
                           202.64359, 201.91534, 199.71538, 195.81636, 196.54405, 197.27652,
                           197.19426, 194.18256, 192.6458, 192.84207, 196.79042, 196.7846,
                           196.92674, 196.46376, 191.8295, 195.27388, 192.87637, 192.93486,
                           193.02173, 194.15596, 195.1885, 196.40945, 199.84824, 195.53864,
                           197.04115, 197.72116, 197.22728, 196.94182, 196.42041, 195.21947,
                           195.96184, 196.06596, 196.13841, 196.02176, 193.37552, 192.61922,
                           190.71645, 198.55496, 195.96136, 197.61163, 197.76743, 197.78378,
                           197.74602, 197.63869, 197.61394, 197.63461, 197.65025, 197.68726,
                           199.8713, 197.80846, 197.87154, 198.00652, 198.07368, 198.14978,
                           198.45114, 201.68332, 201.46805, 202.52077, 203.18263, 199.18858,
                           199.28516, 199.24707, 199.19412, 199.14116, 201.51413, 201.83037,
                           201.80183, 199.36191, 201.62762, 201.90607, 202.1263, 198.6693,
                           199.02565, 200.5548, 201.90771, 201.24632, 202.50056, 204.04204,
                           204.92207, 201.5626, 204.55132, 204.77286, 204.82794, 204.80666,
                           205.281, 206.18332, 205.69135, 204.74947, 204.71005, 204.975,
                           205.4283, 205.7733, 205.93518, 206.53934, 207.06241, 207.46573,
                           208.1082, 208.47726, 208.94116, 209.39586, 209.8639, 210.46793,
                           211.31934, 212.26381, 213.06093, 213.21336, 213.62051, 214.01341,
                           214.45764, 214.68546, 214.9596, 215.21094, 215.70937, 216.26294,
                           216.92047, 217.27635, 217.86389, 218.47159, 219.06175, 219.64195,
                           220.15306, 220.72134, 221.23984, 221.81052, 222.32152, 222.8699,
                           223.36467, 223.89694, 224.38147, 224.97302, 225.42734, 225.92169,
                           226.35909, 226.74117, 227.18661, 227.60684, 228.08817, 228.59859,
                           229.15538, 229.82999, 230.6266, 231.22652, 232.01828, 232.69559,
                           233.49995, 234.59418, 232.85704, 235.31114, 235.83507, 236.2572,
                           237.08904, 237.62637, 238.41718, 239.43188, 240.40306, 240.79529,
                           238.82327, 239.38338, 240.10591, 278.23276, 277.4218, 276.6052,
                           275.78568, 274.96008, 274.13074, 273.2953, 272.45605, 271.6125,
                           270.76328, 269.90988, 269.0515, 268.18738, 267.31735, 266.4429,
                           273.04752, 272.05475, 271.05692, 270.05206, 269.04196, 268.0241,
                           267.00082, 265.97058, 264.9333, 263.89108, 262.84134, 261.7851,
                           264.007, 268.97598, 269.0492, 269.12076, 267.77225, 266.41464,
                           265.04898, 266.12158, 266.4734, 266.96213, 267.5849, 268.11182,
                           268.75647, 269.31506, 270.20975, 271.3285, 272.56412, 273.68524,
                           274.8456, 276.72778, 275.97403, 276.7215, 276.26724, 276.42474,
                           277.05777, 277.59634, 278.32892, 279.09708, 279.76498, 280.014,
                           280.607, 280.89206, 281.66266, 282.58124, 283.77063, 285.53986,
                           287.69547, 290.23495, 293.49304, 292.43768, 291.37375, 292.1308,
                           293.26532, 294.32336, 295.29456, 296.34024, 297.5825, 298.5226,
                           299.67047, 300.0464, 300.51175, 301.21762, 302.23624, 303.36893,
                           304.375, 304.96066, 305.44876, 306.22052, 306.86703, 307.67017,
                           308.58218, 310.221, 311.46942, 312.74188, 312.97086, 312.93222,
                           311.07126, 311.72205, 311.04282, 311.76266, 312.93933, 313.67926,
                           314.3784, 315.32297, 316.2493, 317.44345, 318.4037, 319.88263,
                           321.1115, 322.59607, 323.66693, 324.68478, 325.8305, 327.08896,
                           328.30383, 329.79376]], dtype=np.float32)
        cls.slant_range = xr.DataArray(data=slint, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        cls.surface_sound_speed = xr.DataArray(data=np.array([1447.54], dtype=np.float32),
                                               coords={'time': [1588068664.3947453]})
        bangle = np.array([[0.95156705, 0.9492105, 0.946842, 0.944495, 0.94213647,
                            0.93971974, 0.9373068, 0.9348919, 0.93243545, 0.9300016,
                            0.92755896, 0.92510396, 0.9226397, 0.92016584, 0.9176805,
                            0.91535944, 0.91284955, 0.9103341, 0.9077995, 0.90525347,
                            0.9117404, 0.90954894, 0.9073457, 0.905141, 0.9029314,
                            0.9007129, 0.8984397, 0.8961724, 0.89391273, 0.8918171,
                            0.88953674, 0.88721454, 0.884706, 0.88236296, 0.880274,
                            0.8779241, 0.87555593, 0.8732419, 0.87086385, 0.86847985,
                            0.8660843, 0.8636716, 0.8612514, 0.8588209, 0.8563773,
                            0.85409653, 0.85162884, 0.8491297, 0.8466256, 0.8441475,
                            0.84164137, 0.83911914, 0.8365841, 0.8340372, 0.8316533,
                            0.8290852, 0.8265063, 0.8239171, 0.8213266, 0.818719,
                            0.81610954, 0.81343085, 0.8107753, 0.8081084, 0.80542976,
                            0.8027398, 0.8000378, 0.79732275, 0.79459643, 0.79202515,
                            0.78926, 0.78649193, 0.78372055, 0.78093594, 0.7781367,
                            0.77532023, 0.77266324, 0.7698269, 0.76697505, 0.7640928,
                            0.7612168, 0.7582955, 0.75537485, 0.7524476, 0.7495097,
                            0.74655825, 0.7435903, 0.74060225, 0.73759764, 0.73457897,
                            0.7315598, 0.72852445, 0.7254794, 0.7224216, 0.7193435,
                            0.7162513, 0.7133195, 0.7102021, 0.707069, 0.7039218,
                            0.7007604, 0.6975738, 0.6943808, 0.6911752, 0.6879566,
                            0.68471706, 0.68146324, 0.6781951, 0.6749126, 0.67161566,
                            0.66830444, 0.6649789, 0.661639, 0.6582845, 0.65491575,
                            0.6515325, 0.64813465, 0.6520121, 0.6487624, 0.6452481,
                            0.6417146, 0.6381661, 0.63460606, 0.63101476, 0.6274265,
                            0.62381256, 0.62018263, 0.6165403, 0.6128843, 0.60921234,
                            0.60552484, 0.6018221, 0.59810627, 0.5943742, 0.59062356,
                            0.5870273, 0.5832495, 0.579464, 0.57563424, 0.57181,
                            0.567963, 0.5641036, 0.56022406, 0.5563234, 0.5524105,
                            0.5484885, 0.54455364, 0.54060376, 0.5366392, 0.5326834,
                            0.52868307, 0.5246651, 0.5206375, 0.51659703, 0.5125334,
                            0.50842047, 0.5042975, 0.50023615, 0.49604857, 0.4919821,
                            0.4878347, 0.4836712, 0.47942698, 0.47521043, 0.47100556,
                            0.46685767, 0.46286893, 0.45861042, 0.45436645, 0.45010555,
                            0.44582915, 0.4415425, 0.43722987, 0.4329146, 0.42858708,
                            0.42424655, 0.4198972, 0.4155388, 0.41116905, 0.40678978,
                            0.4023987, 0.3979876, 0.39362264, 0.38910544, 0.38472998,
                            0.38023043, 0.3740921, 0.36957204, 0.3650036, 0.36037016,
                            0.35603094, 0.35142183, 0.3467996, 0.3421651, 0.33751857,
                            0.33285987, 0.3281895, 0.32350755, 0.3185848, 0.31410265,
                            0.3094386, 0.30471313, 0.2999841, 0.29523003, 0.29046416,
                            0.28570914, 0.28098583, 0.27621198, 0.27143085, 0.26671064,
                            0.26186967, 0.25704777, 0.25222933, 0.24740744, 0.24260247,
                            0.23777735, 0.23295867, 0.22810471, 0.22327828, 0.2184515,
                            0.21362495, 0.2087971, 0.20397007, 0.19914389, 0.19432366,
                            0.18952012, 0.18474853, 0.17995834, 0.17513621, 0.17041433,
                            0.16566479, 0.16093433, 0.1561774, 0.15139484, 0.14670336,
                            0.14211595, 0.13751125, 0.13290763, 0.12835026, 0.12390184,
                            0.11928165, 0.11489177, 0.11058831, 0.10638225, 0.10218918,
                            0.09809101, 0.09411192, 0.09029424, 0.08659387, 0.08302879,
                            0.07960093, 0.07642639, 0.07348228, 0.07080531, 0.06845248,
                            0.06635892, 0.0255698, 0.02037287, 0.01518977, 0.01002336,
                            -0.00501072, -0.0021373, -0.00644243, -0.01124883, -0.01642799,
                            -0.02161705, -0.02679217, -0.03197467, -0.03715277, -0.0423162,
                            -0.04751587, -0.05270004, -0.05788016, -0.06305254, -0.06817043,
                            -0.0733211, -0.078444, -0.08375478, -0.08885288, -0.09402931,
                            -0.09916985, -0.10430098, -0.10942435, -0.11453927, -0.11964846,
                            -0.12475097, -0.12984562, -0.13493252, -0.14022827, -0.14508212,
                            -0.15014386, -0.15519798, -0.16024137, -0.16527545, -0.1703043,
                            -0.17555583, -0.18055415, -0.18556726, -0.19056201, -0.19545329,
                            -0.2004149, -0.20536244, -0.2102983, -0.21522248, -0.2201829,
                            -0.22509038, -0.2299788, -0.2348069, -0.23971581, -0.24457252,
                            -0.24941492, -0.25417125, -0.25898993, -0.2638185, -0.2686299,
                            -0.2733873, -0.27816904, -0.2829423, -0.28768802, -0.29233515,
                            -0.29709387, -0.30178285, -0.3064537, -0.3111081, -0.31575727,
                            -0.32039976, -0.31896186, -0.32354224, -0.32812953, -0.3327105,
                            -0.33728278, -0.3418398, -0.34637964, -0.35091567, -0.35543644,
                            -0.35994077, -0.3644364, -0.3689121, -0.37337554, -0.37782443,
                            -0.38243198, -0.386855, -0.3912686, -0.39566922, -0.40005183,
                            -0.40440547, -0.40874934, -0.41307747, -0.41739142, -0.4216851,
                            -0.42596436, -0.43022728, -0.43447983, -0.43871772, -0.44294202,
                            -0.4471438, -0.45133448, -0.45550954, -0.45966816, -0.4638102,
                            -0.46793473, -0.4720441, -0.4761361, -0.48021293, -0.484272,
                            -0.48831546, -0.49234128, -0.49652517, -0.50051785, -0.50449634,
                            -0.5084554, -0.5123985, -0.5163239, -0.52023184, -0.5241244,
                            -0.52799964, -0.53185964, -0.5357039, -0.53953266, -0.5433471,
                            -0.54714763, -0.5509275, -0.5546949, -0.5584433, -0.562178,
                            -0.5659025, -0.56954885, -0.57327, -0.57693255, -0.58057654,
                            -0.584213, -0.5878269, -0.5914299, -0.59519565, -0.5987699,
                            -0.59309095, -0.5964946, -0.5999407, -0.60337543, -0.6081683,
                            -0.61153835, -0.6148931, -0.61823267, -0.6215572, -0.6248664,
                            -0.62816054, -0.6314393, -0.63452953, -0.6377783, -0.6410123,
                            -0.6442311, -0.64743507, -0.6506242, -0.65379834, -0.65730387,
                            -0.66044617, -0.6633996, -0.66651237, -0.66961044, -0.672694,
                            -0.67576283, -0.6788173, -0.6818571, -0.68470824, -0.68771935,
                            -0.690716, -0.6939488, -0.6970569, -0.70003766, -0.70300436,
                            -0.70592415, -0.70882994, -0.71172184, -0.7146564, -0.71756065,
                            -0.7204544, -0.72333765, -0.72620535, -0.7290622, -0.7319036,
                            -0.73473954, -0.73756754, -0.7405596, -0.74336123, -0.7461508,
                            -0.7489442, -0.75166285, -0.75440353, -0.7571033, -0.7598046,
                            -0.76250434, -0.7651891, -0.76786584, -0.7705308, -0.7731809,
                            -0.7758087, -0.7784321, -0.7810361, -0.783639, -0.78623337,
                            -0.78882205, -0.7914121, -0.7941746, -0.796759, -0.79952407,
                            -0.8018245, -0.8042882, -0.80678326, -0.80945104, -0.8119301,
                            -0.81439537, -0.8168511, -0.8192999, -0.82173026, -0.8241543,
                            -0.82654876, -0.8289344, -0.83131427, -0.83369046, -0.8360584,
                            -0.8384127, -0.8407458, -0.8430658, -0.84538186, -0.8476843,
                            -0.84997964, -0.852443, -0.85473734, -0.8570119, -0.8592766,
                            -0.8615058, -0.86371845, -0.85669976, -0.8594873, -0.86188,
                            -0.86464953, -0.8672443, -0.8698187, -0.8723823, -0.8749424,
                            -0.87749255, -0.88004, -0.8827481, -0.8852839, -0.8878038,
                            -0.89032096, -0.89281857, -0.8953058, -0.8977869, -0.90026194,
                            -0.90272695, -0.90518963]], dtype=np.float32)
        cls.beam_angle = xr.DataArray(data=bangle, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        cls.tx_beam_width = 2.0
        cls.rx_beam_width = 2.0
        plength = np.array([[0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942, 0.00750942, 0.00750942, 0.00750942,
                             0.00750942, 0.00750942]], dtype=np.float32)
        cls.pulse_length = xr.DataArray(data=plength, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        tvgval = np.array([[94.286285, 94.162544, 94.060715, 93.760475, 93.47481, 93.5167,
                            93.47398, 93.38478, 93.51304, 93.4292, 93.34359, 93.27971,
                            93.21636, 93.15497, 93.10747, 93.077126, 93.067024, 93.03107,
                            93.05917, 93.098495, 92.49827, 92.39202, 92.29616, 92.14751,
                            91.96231, 91.76822, 91.85768, 91.84564, 91.71706, 91.59453,
                            91.46152, 91.53217, 91.602036, 91.67111, 91.1598, 91.13257,
                            91.15361, 90.74786, 90.69037, 90.59834, 90.510315, 90.46226,
                            90.38871, 90.30888, 90.24014, 90.17846, 90.11933, 90.19418,
                            90.22448, 90.003296, 89.8909, 89.808586, 89.73201, 89.656586,
                            89.57873, 89.48422, 89.382454, 89.26653, 89.076454, 88.91889,
                            88.68883, 88.85919, 88.778854, 88.691414, 88.60036, 88.49835,
                            88.39462, 88.291405, 88.17956, 88.11197, 88.09572, 88.007286,
                            87.8498, 87.69441, 87.55097, 87.43565, 87.327705, 87.16542,
                            87.01852, 87.000565, 86.83506, 86.91269, 86.880936, 86.80078,
                            86.697174, 86.59288, 86.5138, 86.48296, 86.4735, 86.466156,
                            86.35868, 86.269356, 86.14618, 86.01649, 85.93478, 85.85304,
                            85.76204, 85.65818, 85.567764, 85.4773, 85.38678, 85.3859,
                            85.32056, 85.24412, 85.15732, 85.12446, 85.091644, 85.058876,
                            85.02618, 84.99352, 84.96093, 84.92841, 84.895966, 84.863594,
                            84.8313, 84.79909, 84.76696, 86.52323, 85.81413, 85.70538,
                            85.62674, 85.54134, 85.42534, 85.43475, 85.292145, 85.23165,
                            85.17343, 85.08886, 84.98718, 84.89037, 84.790405, 84.68656,
                            84.56109, 84.44005, 84.34466, 84.26531, 84.1338, 83.93219,
                            83.98446, 83.85054, 83.779564, 83.68144, 83.627014, 83.62532,
                            83.59459, 83.50889, 83.40163, 83.29185, 83.17828, 82.84263,
                            82.78138, 82.74627, 82.66033, 82.55592, 82.5338, 82.84096,
                            83.101295, 82.65186, 83.24574, 82.5823, 82.540665, 82.51928,
                            83.12563, 83.33806, 83.321846, 82.6536, 81.92631, 82.04605,
                            81.894295, 81.781906, 81.69882, 81.59422, 81.63103, 81.571655,
                            81.51726, 81.4795, 81.41556, 81.329636, 81.24942, 81.15923,
                            81.083885, 81.11535, 80.54802, 81.50156, 80.866234, 81.44221,
                            80.52343, 80.16093, 80.13519, 80.60347, 79.76911, 79.76105,
                            79.7564, 79.75264, 79.74912, 79.748344, 79.75061, 79.75552,
                            80.33339, 79.84884, 79.34563, 79.36632, 79.32271, 79.4408,
                            79.58803, 79.53476, 79.0614, 79.03497, 79.00681, 78.21637,
                            78.71655, 78.924164, 79.03096, 79.12365, 78.98759, 79.03012,
                            78.97034, 79.26532, 79.24956, 79.22804, 79.207375, 79.21149,
                            79.22888, 79.27027, 79.29444, 79.1978, 78.82163, 78.74053,
                            79.12573, 78.51709, 78.36587, 78.169754, 78.50988, 79.36164,
                            79.44586, 78.64982, 78.379814, 78.51298, 78.559944, 74.674805,
                            79.7495, 79.6207, 79.22148, 78.47534, 78.61996, 78.76336,
                            78.74827, 78.149536, 75.300964, 75.85885, 78.67269, 78.67212,
                            78.70034, 78.61053, 72.615555, 78.3754, 76.75956, 76.91901,
                            77.15301, 78.95814, 79.15679, 79.38721, 80.013855, 79.22306,
                            79.50433, 79.62913, 79.538, 79.484665, 79.38694, 79.15928,
                            79.29947, 79.31829, 79.33108, 79.30804, 78.07085, 76.03574,
                            65.30978, 79.772255, 79.290886, 79.597404, 79.62483, 79.62632,
                            79.617966, 79.59664, 79.590515, 79.592575, 79.59387, 79.59881,
                            79.99405, 79.61746, 79.62716, 79.650055, 79.660385, 79.67239,
                            79.725555, 80.30239, 80.26277, 80.44455, 80.557076, 79.84912,
                            79.86428, 79.85504, 79.842804, 79.83081, 80.25415, 80.30764,
                            80.300316, 79.86065, 80.26474, 80.31141, 80.34775, 79.722145,
                            79.7849, 80.06059, 80.29928, 80.17907, 80.3985, 80.66385,
                            80.81213, 80.2245, 80.74406, 80.77963, 80.78663, 80.7805,
                            80.85901, 81.00935, 80.35674, 80.19092, 80.181656, 80.22563,
                            80.30224, 80.359726, 80.38539, 80.486855, 80.573975, 80.64021,
                            80.74638, 80.806145, 80.881454, 80.95484, 81.03013, 81.12725,
                            81.26384, 81.41411, 81.539444, 81.56183, 81.624695, 81.68493,
                            81.75295, 81.78698, 81.82823, 81.865906, 81.94172, 82.02553,
                            82.12493, 82.17787, 82.26579, 82.356255, 82.44372, 82.52914,
                            82.60391, 82.6868, 82.76195, 82.84448, 82.91795, 82.99646,
                            83.06703, 83.14267, 83.211075, 83.294525, 83.35818, 83.42722,
                            83.48812, 83.541016, 83.60263, 83.66049, 83.726685, 83.79666,
                            83.87283, 83.96482, 84.072945, 84.15373, 84.26019, 84.35057,
                            84.45761, 84.6022, 84.37089, 84.69601, 84.76437, 84.819244,
                            84.92727, 84.996544, 85.09833, 85.22825, 85.35168, 84.71295,
                            84.46316, 84.534485, 84.62606, 88.9299, 88.84736, 88.764046,
                            88.67994, 88.59503, 88.5093, 88.42272, 88.3353, 88.24698,
                            88.157776, 88.06765, 87.9766, 87.884605, 87.791626, 87.69766,
                            88.4005, 88.29682, 88.19201, 88.08602, 87.978836, 87.870415,
                            87.76075, 87.64981, 87.53757, 87.42398, 87.30903, 87.19268,
                            87.43803, 87.97594, 87.98418, 87.99232, 87.84836, 87.70248,
                            87.554634, 87.67169, 87.71028, 87.76365, 87.83124, 87.88841,
                            87.958, 88.01815, 88.11396, 88.23302, 88.363846, 88.48182,
                            88.60329, 88.79852, 88.721405, 88.79906, 88.75278, 88.76973,
                            88.83549, 88.89144, 88.96708, 89.04613, 89.114685, 89.14066,
                            89.20138, 89.23092, 89.309296, 89.40226, 89.52199, 89.698524,
                            89.911835, 90.16039, 90.475334, 90.37467, 90.2728, 90.34653,
                            90.4564, 90.55838, 90.65167, 90.75168, 90.86987, 90.95902,
                            91.06732, 91.10327, 91.14743, 91.213844, 91.309135, 91.414566,
                            91.507965, 91.56241, 91.60791, 91.67916, 91.73891, 91.81267,
                            91.89622, 92.044754, 92.15754, 92.271996, 92.29318, 92.2905,
                            91.479485, 91.53801, 91.47875, 91.54347, 91.64801, 91.713974,
                            91.77613, 91.85958, 91.9411, 92.045654, 92.12963, 92.25781,
                            92.36405, 92.49153, 92.5834, 92.67039, 92.76792, 92.87451,
                            92.97707, 93.102005]], dtype=np.float32)
        cls.tvg = xr.DataArray(data=tvgval, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        fgvals = np.array([[31.241974, 31.231949, 31.221054, 31.20839, 31.194763, 31.180908,
                            31.165543, 31.149033, 31.131363, 31.112213, 31.092072, 31.070877,
                            31.048706, 31.02562, 31.001709, 30.976929, 30.951172, 30.924286,
                            30.896164, 30.866653, 31.144333, 31.226166, 31.306702, 31.38556,
                            31.462982, 31.539368, 31.614395, 31.68811, 31.760498, 31.831543,
                            31.901276, 31.96965, 32.036713, 32.102417, 32.166534, 32.22957,
                            32.291214, 32.35051, 32.409256, 32.466324, 32.521957, 32.57608,
                            32.6286, 32.67952, 32.728836, 32.776566, 32.822754, 32.86737,
                            32.910446, 32.951996, 32.992035, 33.03041, 33.06726, 33.102646,
                            33.13655, 33.16899, 33.19998, 33.229492, 33.257538, 33.28424,
                            33.309433, 33.333115, 33.35524, 33.375763, 33.394592, 33.411636,
                            33.426544, 33.439484, 33.450302, 33.458908, 33.4655, 33.469803,
                            33.472, 33.472046, 33.470276, 33.4666, 33.460846, 33.453278,
                            33.443558, 33.432114, 33.418533, 33.402863, 33.384995, 33.364838,
                            33.342316, 33.317352, 33.289825, 33.25966, 33.22673, 33.19095,
                            33.152206, 33.110367, 33.065323, 33.016846, 32.965042, 32.90988,
                            32.851395, 32.789536, 32.72441, 32.65573, 32.583496, 32.507736,
                            32.428116, 32.344757, 32.25737, 32.16574, 32.069626, 31.968735,
                            31.862793, 31.751572, 31.634995, 31.513046, 31.385712, 31.252975,
                            31.114822, 30.970871, 30.820557, 36.93094, 37.107468, 37.278687,
                            37.443604, 37.602676, 37.756348, 37.90535, 38.04944, 38.189133,
                            38.32393, 38.453888, 38.578644, 38.698273, 38.81311, 38.92325,
                            39.028946, 39.13037, 39.22766, 39.32083, 39.409943, 39.494965,
                            39.575943, 39.65274, 39.725143, 39.793213, 39.856644, 39.915665,
                            39.97023, 40.020355, 40.06633, 40.108063, 40.145737, 40.179306,
                            40.209076, 40.235092, 40.25717, 40.27536, 40.289734, 40.30037,
                            40.306763, 40.308136, 40.305237, 40.296387, 40.282516, 40.26375,
                            40.240524, 40.2126, 40.180008, 40.142426, 40.10019, 40.053665,
                            40.002, 39.94516, 39.88292, 39.815033, 39.74115, 39.661026,
                            39.574326, 39.480743, 39.380188, 39.27269, 39.15825, 39.03688,
                            38.908386, 38.772522, 38.62906, 38.477676, 38.317764, 38.14868,
                            39.707947, 39.938538, 40.157776, 40.366257, 40.564453, 40.752533,
                            40.930634, 41.098877, 41.2576, 41.40718, 41.54808, 41.68068,
                            41.804993, 41.92096, 42.02849, 42.127716, 42.219147, 42.303513,
                            42.381226, 42.452454, 42.51686, 42.574448, 42.62491, 42.667862,
                            42.70378, 42.7321, 42.75302, 42.76683, 42.773804, 42.774384,
                            42.76828, 42.755493, 42.735687, 42.70883, 42.67505, 42.6344,
                            42.586884, 42.53209, 42.469604, 42.398926, 42.31984, 42.232468,
                            42.136765, 42.03264, 41.920364, 41.800064, 41.67186, 41.535202,
                            41.38913, 41.232758, 41.06569, 40.887863, 40.699142, 40.49936,
                            40.288086, 40.064316, 39.827393, 39.576843, 39.312363, 39.033554,
                            38.739777, 38.429886, 38.102783, 37.757233, 37.391846, 37.005203,
                            36.59584, 36.16165, 35.699844, 35.20764, 37.43875, 37.839584,
                            38.21309, 38.56122, 38.88591, 39.18892, 39.471848, 39.736313,
                            39.983765, 40.215363, 40.432175, 40.63524, 40.825058, 41.00203,
                            41.166428, 41.31877, 41.459747, 41.590042, 41.710236, 41.820404,
                            41.920578, 42.01065, 42.091385, 42.163498, 42.227783, 42.28473,
                            42.334213, 42.376038, 42.41005, 42.436188, 42.454376, 42.46457,
                            42.46698, 42.46199, 42.45009, 42.43158, 42.406418, 42.374496,
                            42.33571, 42.290085, 42.237762, 42.178925, 42.113617, 42.041534,
                            41.96231, 41.875626, 41.781326, 41.67955, 41.570343, 41.453873,
                            41.33029, 41.1998, 41.062622, 40.918518, 40.766937, 40.60721,
                            40.438812, 40.261658, 40.07576, 39.881195, 39.677902, 39.465393,
                            39.243225, 39.011154, 38.768524, 38.515472, 38.251785, 37.97725,
                            37.691345, 37.39331, 39.48253, 39.593857, 39.696976, 39.79251,
                            39.88095, 39.962585, 40.037613, 40.106247, 40.16855, 40.22458,
                            40.27417, 40.317413, 40.35434, 40.38533, 40.410553, 40.430435,
                            40.44507, 40.454758, 40.459732, 40.46025, 40.456314, 40.44815,
                            40.435684, 40.419144, 40.39827, 40.372833, 40.34247, 40.307022,
                            40.266724, 40.22174, 40.172607, 40.11946, 40.062653, 40.00203,
                            39.937668, 39.869675, 39.797928, 39.72235, 39.642868, 39.55934,
                            39.471725, 39.379883, 39.283707, 39.183075, 39.07794, 38.968323,
                            38.85434, 38.736115, 38.613785, 38.487396, 38.356934, 38.222244,
                            38.08351, 37.940475, 37.793045, 37.641098, 37.484222, 37.322235,
                            37.155045, 36.982758, 36.805847, 36.623596, 36.437027, 36.245514,
                            36.048767, 35.846436, 35.637756, 35.422424, 35.200333, 35.387314,
                            35.513306, 35.633423, 35.74817, 35.855026, 35.95938, 36.058548,
                            36.152542, 36.241425, 36.325363, 36.404587, 36.479355, 36.54991,
                            36.616516, 36.67926, 36.738464, 36.794144, 36.84639, 36.89531,
                            36.939957, 36.98239, 37.02162, 37.057632, 37.090454, 37.120117,
                            37.14662, 37.17015, 37.190887, 37.20874, 37.223923, 37.236526,
                            37.24614, 37.253098, 37.258453, 37.261597, 37.26277, 37.262054,
                            37.2592, 37.254135, 37.247284, 37.238403, 37.22786, 37.215347,
                            37.200974, 37.184845, 37.166595, 37.146317, 37.12381, 37.099304,
                            37.07274, 37.04431, 37.014084, 36.982086, 36.948456, 36.913284,
                            36.876648, 36.838562, 36.79904, 36.75807, 36.715714, 36.67195,
                            36.626785, 36.580246, 36.532303, 36.48294, 36.43184, 36.379456,
                            36.325287, 36.26985, 36.213226, 36.155106, 36.095505, 36.034348,
                            35.97168, 35.90744, 35.841644, 35.774323, 35.705444, 35.63501,
                            35.56317, 35.489944, 35.415543, 35.339676, 35.262512, 35.18405,
                            35.10431, 35.023422, 34.941284, 34.85785, 34.77318, 34.68718,
                            34.599884, 34.511215, 34.421143, 34.329636, 34.236465, 34.141968,
                            28.853363, 28.908249, 28.961578, 29.01271, 29.062073, 29.10971,
                            29.155838, 29.200134, 29.242859, 29.283981, 29.323456, 29.361252,
                            29.39737, 29.431824, 29.464539, 29.495651, 29.52507, 29.553223,
                            29.579971, 29.605179]], dtype=np.float32)
        cls.fixedgain = xr.DataArray(data=fgvals, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})
        absval = np.array([[6.445136, 6.445136, 6.445136, 6.445136, 6.445136, 6.445136,
                            6.445136, 6.445136, 6.445136, 6.445136, 6.445136, 6.445136,
                            6.445136, 6.445136, 6.445136, 6.445136, 6.445136, 6.445136,
                            6.445136, 6.445136, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 5.842397, 5.842397, 5.842397,
                            5.842397, 5.842397, 5.842397, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503, 7.8390503,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.213079, 7.213079,
                            7.213079, 7.213079, 7.213079, 7.213079, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.997155, 7.997155, 7.997155, 7.997155,
                            7.997155, 7.997155, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037,
                            7.3686037, 7.3686037, 7.3686037, 7.3686037, 7.3686037, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336, 6.5974336,
                            5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136,
                            5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136,
                            5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136, 5.9921136,
                            5.9921136, 5.9921136]], dtype=np.float32)
        cls.absorption = xr.DataArray(data=absval, coords={'time': [1588068664.3947453], 'beam': np.arange(512)})

    def setUp(self) -> None:
        self.bscatter = Kmallscatter(self.rdict, self.raw_intensity, self.slant_range, self.surface_sound_speed,
                                     self.beam_angle, self.tx_beam_width, self.rx_beam_width, self.pulse_length,
                                     self.tvg, self.fixedgain, self.absorption, None)
        self.rint_answer = 14.537903
        self.fgain_answer = 31.241974
        self.areacorr_answer = 18.960098
        self.tvg_answer = 94.286285
        self.tlloss_answer = 105.50243

    def test_init(self):
        assert (self.bscatter.raw_intensity == self.raw_intensity).all()
        assert (self.bscatter.slant_range == self.slant_range).all()
        assert (self.bscatter.surface_sound_speed == self.surface_sound_speed).all()
        assert (self.bscatter.beam_angle == self.beam_angle).all()
        assert self.bscatter.runtime_parameters == self.rdict
        assert (self.bscatter.absorption_db_m == self.absorption / 1000).all()
        assert (self.bscatter.fixedgain == self.fixedgain).all()
        assert (self.bscatter.pulse_length == self.pulse_length).all()
        assert (self.bscatter.tvg_arr == self.tvg).all()

        assert self.bscatter.tx_beam_width == self.tx_beam_width
        assert self.bscatter.rx_beam_width == self.rx_beam_width

    def test_raw_intensity(self):
        assert np.allclose(self.bscatter.raw_intensity.values[0, 0], self.rint_answer)

    def test_area_correction(self):
        assert np.allclose(self.bscatter.area_correction.values[0, 0], self.areacorr_answer)

    def test_fixed_gain(self):
        assert np.allclose(self.bscatter.fixed_gain.values[0, 0], self.fgain_answer)

    def test_attenuation(self):
        assert np.allclose(self.bscatter.attenuation.values[0, 0], 2.1773381)

    def test_spherical_spreading(self):
        assert np.allclose(self.bscatter.spherical_spreading.values[0, 0], 50.57388)

    def test_transmission_loss(self):
        assert np.allclose(self.bscatter.transmission_loss.values[0, 0], self.tlloss_answer)

    def test_tvg(self):
        assert np.allclose(self.bscatter.tvg.values[0, 0], self.tvg_answer)

    def test_process(self):
        assert np.allclose(
            self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False, transmission_loss_corrected=False,
                                  area_corrected=False).values[0, 0], self.rint_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False,
                                                 transmission_loss_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False, tvg_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer)
        assert np.allclose(self.bscatter.process(fixed_gain_corrected=False).values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer)
        assert np.allclose(self.bscatter.process().values[0, 0],
                           self.rint_answer - self.areacorr_answer + self.tlloss_answer - self.tvg_answer - self.fgain_answer)